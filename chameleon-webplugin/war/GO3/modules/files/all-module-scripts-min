GO.files.FilePropertiesDialog=function(B){if(!B){B={}}this.propertiesPanel=new Ext.Panel({layout:"form",title:GO.lang.strProperties,cls:"go-form-panel",waitMsgTarget:true,labelWidth:100,defaultType:"textfield",items:[{fieldLabel:GO.lang.strName,name:"name",anchor:"100%",validator:function(D){return !D.match(/[&\/:\*\?"<>|\\]/)}},{xtype:"plainfield",fieldLabel:GO.lang.strLocation,name:"path"},new GO.form.HtmlComponent({html:"<hr />"}),{xtype:"plainfield",fieldLabel:GO.lang.strCtime,name:"ctime"},{xtype:"plainfield",fieldLabel:GO.lang.strMtime,name:"mtime"},{xtype:"plainfield",fieldLabel:GO.lang.Atime,name:"atime"},new GO.form.HtmlComponent({html:"<hr />"}),{xtype:"plainfield",fieldLabel:GO.lang.strType,name:"type"},{xtype:"plainfield",fieldLabel:GO.lang.strSize,name:"size"}]});this.commentsPanel=new Ext.Panel({layout:"form",labelWidth:70,title:GO.files.lang.comments,border:false,items:new Ext.form.TextArea({name:"comments",fieldLabel:"",hideLabel:true,anchor:"100% 100%"})});this.versionsGrid=new GO.files.VersionsGrid();var A=[this.propertiesPanel,this.commentsPanel,this.versionsGrid];if(GO.workflow){this.workflowPanel=new GO.workflow.FilePropertiesPanel();A.push(this.workflowPanel)}this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,doLayoutOnTabChange:true,border:false,anchor:"100% 100%",hideLabel:true,items:A});this.formPanel=new Ext.form.FormPanel({waitMsgTarget:true,border:false,defaultType:"textfield",items:this.tabPanel});var C=[{iconCls:"btn-save",text:GO.lang.download,cls:"x-btn-text-icon",handler:function(){window.location.href=GO.settings.modules.files.url+"download.php?mode=download&id="+this.file_id},scope:this}];if(GO.settings.modules.gota&&GO.settings.modules.gota.read_permission){C.push({iconCls:"btn-edit",text:GO.files.lang.downloadGOTA,cls:"x-btn-text-icon",handler:function(){if(!deployJava.isWebStartInstalled("1.6.0")){Ext.MessageBox.alert(GO.lang.strError,GO.lang.noJava)}else{window.location.href=GO.settings.modules.gota.url+"jnlp.php?id="+this.file_id}},scope:this})}GO.files.FilePropertiesDialog.superclass.constructor.call(this,{title:GO.lang.strProperties,layout:"fit",width:650,height:550,closeAction:"hide",items:this.formPanel,maximizable:true,collapsible:true,tbar:C,buttons:[{text:GO.lang.cmdOk,handler:function(){this.save(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.save(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});this.addEvents({rename:true})};Ext.extend(GO.files.FilePropertiesDialog,Ext.Window,{folder_id:0,show:function(B,A){A=A||{};this.setFileID(B);if(!this.rendered){this.render(Ext.getBody())}this.formPanel.form.reset();this.tabPanel.setActiveTab(0);var C={file_id:B,task:"file_properties"};if(A.loadParams){Ext.apply(C,A.loadParams)}this.formPanel.form.load({url:GO.settings.modules.files.url+"json.php",params:C,success:function(D,E){this.setWritePermission(E.result.data.write_permission);if(E.result.data.file_id){this.setFileID(E.result.data.file_id)}this.folder_id=E.result.data.folder_id;GO.files.FilePropertiesDialog.superclass.show.call(this)},failure:function(D,E){Ext.MessageBox.alert(GO.lang.strError,E.result.feedback)},scope:this})},setFileID:function(A){this.file_id=A;this.versionsGrid.setFileID(A)},setWritePermission:function(A){var B=this.formPanel.form;B.findField("name").setDisabled(!A)},save:function(A){this.formPanel.form.submit({url:GO.settings.modules.files.url+"action.php",params:{file_id:this.file_id,task:"file_properties"},waitMsg:GO.lang.waitMsgSave,success:function(B,C){if(C.result.path){this.formPanel.form.findField("path").setValue(C.result.path);this.fireEvent("rename",this,this.folder_id)}if(A){this.hide()}},failure:function(C,D){var B="";if(D.failureType=="client"){B=GO.lang.strErrorsInForm}else{B=D.result.feedback}Ext.MessageBox.alert(GO.lang.strError,B)},scope:this})}});GO.files.FolderPropertiesDialog=function(A){if(!A){A={}}this.propertiesPanel=new Ext.Panel({layout:"form",title:GO.lang.strProperties,cls:"go-form-panel",waitMsgTarget:true,defaultType:"textfield",labelWidth:100,border:false,items:[{fieldLabel:GO.lang.strName,name:"name",anchor:"100%",validator:function(B){return !B.match(/[&\/:\*\?"<>|\\]/)}},{xtype:"plainfield",fieldLabel:GO.lang.strLocation,name:"path"},new GO.form.HtmlComponent({html:"<hr />"}),{xtype:"plainfield",fieldLabel:GO.lang.strCtime,name:"ctime"},{xtype:"plainfield",fieldLabel:GO.lang.strMtime,name:"mtime"},{xtype:"plainfield",fieldLabel:GO.lang.Atime,name:"atime"},{xtype:"htmlcomponent",html:"<hr />"},{xtype:"plainfield",fieldLabel:GO.lang.strType,name:"type"},{xtype:"plainfield",fieldLabel:GO.lang.strSize,name:"size"},new Ext.form.Checkbox({boxLabel:GO.files.lang.activateSharing,name:"share",checked:false,hideLabel:true}),new Ext.form.Checkbox({boxLabel:GO.files.lang.notifyChanges,name:"notify",checked:false,hideLabel:true})]});this.readPermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strReadPermissions});this.writePermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strWritePermissions});this.commentsPanel=new Ext.Panel({layout:"form",labelWidth:70,title:GO.files.lang.comments,border:false,items:new Ext.form.TextArea({name:"comments",fieldLabel:"",hideLabel:true,anchor:"100% 100%"})});this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,border:false,anchor:"100% 100%",hideLabel:true,items:[this.propertiesPanel,this.commentsPanel,this.readPermissionsTab,this.writePermissionsTab]});if(GO.workflow){this.workflowPanel=new GO.workflow.FolderPropertiesPanel();this.tabPanel.insert(2,this.workflowPanel)}this.formPanel=new Ext.form.FormPanel({waitMsgTarget:true,border:false,defaultType:"textfield",items:this.tabPanel});GO.files.FolderPropertiesDialog.superclass.constructor.call(this,{title:GO.lang.strProperties,layout:"fit",width:500,height:400,closeAction:"hide",items:this.formPanel,buttons:[{text:GO.lang.cmdOk,handler:function(){this.save(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.save(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});this.addEvents({rename:true})};Ext.extend(GO.files.FolderPropertiesDialog,Ext.Window,{parent_id:0,show:function(A){this.folder_id=A;if(!this.rendered){this.render(Ext.getBody())}this.formPanel.form.load({url:GO.settings.modules.files.url+"json.php",params:{folder_id:A,task:"folder_properties"},success:function(C,D){var B=this.formPanel.form.findField("share");B.setValue(D.result.data.acl_read>0);this.parent_id=D.result.data.parent_id;this.readPermissionsTab.setAcl(D.result.data.acl_read);this.writePermissionsTab.setAcl(D.result.data.acl_write);this.setWritePermission(D.result.data.is_home_dir,D.result.data.write_permission,D.result.data.is_owner);this.tabPanel.setActiveTab(0);GO.files.FolderPropertiesDialog.superclass.show.call(this)},failure:function(B,C){Ext.MessageBox.alert(GO.lang.strError,C.result.feedback)},scope:this})},setWritePermission:function(B,A,D){var C=this.formPanel.form;C.findField("name").setDisabled(B||!A);C.findField("share").setDisabled(B||!D||!A);this.readPermissionsTab.setDisabled(!A||this.readPermissionsTab.acl_id==0);this.writePermissionsTab.setDisabled(!A||this.writePermissionsTab.acl_id==0)},save:function(A){this.formPanel.form.submit({url:GO.settings.modules.files.url+"action.php",params:{folder_id:this.folder_id,task:"folder_properties"},waitMsg:GO.lang.waitMsgSave,success:function(B,C){if(C.result.acl_read){this.readPermissionsTab.setAcl(C.result.acl_read);this.writePermissionsTab.setAcl(C.result.acl_write)}if(C.result.path){this.formPanel.form.findField("path").setValue(C.result.path);this.fireEvent("rename",this,this.parent_id)}if(A){this.hide()}},failure:function(C,D){var B="";if(D.failureType=="client"){B=GO.lang.strErrorsInForm}else{B=D.result.feedback}Ext.MessageBox.alert(GO.lang.strError,B)},scope:this})}});GO.files.FilesContextMenu=function(A){if(!A){A={}}A.shadow="frame";A.minWidth=180;this.downloadButton=new Ext.menu.Item({iconCls:"btn-save",text:GO.lang.download,cls:"x-btn-text-icon",handler:function(){window.location.href=GO.settings.modules.files.url+"download.php?mode=download&id="+this.records[0].data.id},scope:this});this.gotaButton=new Ext.menu.Item({iconCls:"btn-edit",text:GO.files.lang.downloadGOTA,cls:"x-btn-text-icon",handler:function(){if(!deployJava.isWebStartInstalled("1.6.0")){Ext.MessageBox.alert(GO.lang.strError,GO.lang.noJava)}else{window.location.href=GO.settings.modules.gota.url+"jnlp.php?id="+this.records[0].data.id}},scope:this});this.deleteButton=new Ext.menu.Item({iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.fireEvent("delete",this,this.records,this.clickedAt)},scope:this});this.cutButton=new Ext.menu.Item({iconCls:"btn-cut",text:GO.lang.cut,cls:"x-btn-text-icon",handler:function(){this.fireEvent("cut",this,this.records,this.clickedAt)},scope:this});this.copyButton=new Ext.menu.Item({iconCls:"btn-copy",text:GO.lang.copy,cls:"x-btn-text-icon",handler:function(){this.fireEvent("copy",this,this.records,this.clickedAt)},scope:this});this.compressButton=new Ext.menu.Item({iconCls:"btn-compress",text:GO.lang.compress,cls:"x-btn-text-icon",handler:function(){this.fireEvent("compress",this,this.records,this.clickedAt)},scope:this});this.decompressButton=new Ext.menu.Item({iconCls:"btn-decompress",text:GO.lang.decompress,cls:"x-btn-text-icon",handler:function(){this.fireEvent("decompress",this,this.records,this.clickedAt)},scope:this});A.items=[this.downloadButton];if(GO.settings.modules.gota&&GO.settings.modules.gota.read_permission){A.items.push(this.gotaButton)}A.items.push({iconCls:"btn-properties",text:GO.lang.strProperties,handler:function(){this.fireEvent("properties",this,this.records)},scope:this});A.items.push(new Ext.menu.Separator());A.items.push(this.cutButton);A.items.push(this.copyButton);A.items.push(new Ext.menu.Separator());A.items.push(this.deleteButton);A.items.push(this.compressSeparator=new Ext.menu.Separator());A.items.push(this.compressButton);A.items.push(this.decompressButton);GO.files.FilesContextMenu.superclass.constructor.call(this,A);this.addEvents({properties:true,paste:true,cut:true,copy:true,"delete":true,compress:true,decompress:true})};Ext.extend(GO.files.FilesContextMenu,Ext.menu.Menu,{clickedAt:"grid",records:[],showAt:function(C,B,A){if(A){this.clickedAt=A}var D="";this.records=B;if(B.length=="1"){D=B[0].data.extension;switch(D){case"zip":case"tar":case"tgz":case"gz":this.downloadButton.show();this.gotaButton.show();this.decompressButton.show();this.compressButton.hide();break;case"":case"folder":this.downloadButton.hide();this.gotaButton.hide();this.decompressButton.hide();this.compressButton.show();break;default:this.downloadButton.show();this.gotaButton.show();this.compressButton.show();this.decompressButton.hide();break}}else{this.compressButton.show();this.decompressButton.hide();this.downloadButton.hide();this.gotaButton.hide()}GO.files.FilesContextMenu.superclass.showAt.call(this,C)}});GO.files.TemplateWindow=function(A){this.gridStore=new GO.data.JsonStore({url:GO.settings.modules.files.url+"json.php",baseParams:{task:"templates",writable_only:"true"},root:"results",totalProperty:"total",id:"id",fields:["id","name","type","grid_display"],remoteSort:true});this.gridStore.on("load",function(){this.firstLoad=false},this,{single:true});this.gridStore.load();this.gridPanel=new GO.grid.GridPanel({region:"center",layout:"fit",split:true,paging:true,store:this.gridStore,columns:[{header:GO.lang.strName,dataIndex:"grid_display",sortable:true},{header:GO.lang.strType,dataIndex:"type",sortable:false}],view:new Ext.grid.GridView({autoFill:true,forceFit:true}),sm:new Ext.grid.RowSelectionModel(),loadMask:true,tbar:[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",scope:this,handler:function(){this.showTemplate()}},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",scope:this,handler:function(){this.gridPanel.deleteSelected()}}]});this.gridPanel.on("rowdblclick",function(B){this.showTemplate(B.selModel.selections.keys[0])},this);GO.files.TemplateWindow.superclass.constructor.call(this,{title:"Templates",layout:"fit",width:500,height:400,closeAction:"hide",items:this.gridPanel,buttons:[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.files.TemplateWindow,Ext.Window,{firstLoad:true,showTemplate:function(A){if(!this.templateDialog){this.uploadFile=new GO.form.UploadFile({inputName:"file",max:1});this.downloadButton=new Ext.Button({handler:function(){document.location.href="download_template.php?template_id="+this.template_id},disabled:true,text:GO.files.lang.downloadTemplate,scope:this});this.formPanel=new Ext.form.FormPanel({title:GO.lang.strProperties,cls:"go-form-panel",waitMsgTarget:true,labelWidth:85,defaultType:"textfield",fileUpload:true,items:[{fieldLabel:GO.lang.strName,name:"name",id:"template-name",anchor:"100%",allowBlank:false},this.selectUser=new GO.form.SelectUser({fieldLabel:GO.lang.strUser,disabled:!GO.settings.modules.email["write_permission"],allowBlank:false,anchor:"100%"}),new GO.form.HtmlComponent({html:"<br />"}),this.uploadFile,new GO.form.HtmlComponent({html:"<br />"}),this.downloadButton]});var B=[{text:GO.lang.cmdOk,handler:function(){this.saveTemplate(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.saveTemplate(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.templateDialog.hide()},scope:this}];this.templateDialog=new Ext.Window({layout:"fit",modal:false,height:400,width:400,closeAction:"hide",title:GO.files.lang.template,items:[this.templateTabPanel=new Ext.TabPanel({activeTab:0,border:false,items:[this.formPanel,this.readPermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strReadPermissions}),this.writePermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strWritePermissions})]})],buttons:B,focus:function(){Ext.get("template-name").focus()}})}this.template_id=A;this.templateTabPanel.setActiveTab(0);if(this.template_id>0){this.readPermissionsTab.setDisabled(false);this.writePermissionsTab.setDisabled(false);this.loadTemplate()}else{this.formPanel.form.reset();this.readPermissionsTab.setAcl(0);this.writePermissionsTab.setAcl(0);this.downloadButton.setDisabled(true)}this.templateDialog.show()},loadTemplate:function(){this.formPanel.form.load({url:GO.settings.modules.files.url+"json.php",params:{template_id:this.template_id,task:"template"},success:function(A,B){this.selectUser.setRemoteText(B.result.data.user_name);this.readPermissionsTab.setAcl(B.result.data.acl_read);this.writePermissionsTab.setAcl(B.result.data.acl_write);this.downloadButton.setDisabled(false)},scope:this})},saveTemplate:function(A){this.formPanel.form.submit({waitMsg:GO.lang.waitMsgSave,url:GO.settings.modules.files.url+"action.php",params:{task:"save_template",template_id:this.template_id},success:function(B,C){this.template_id=C.result.template_id;this.gridStore.reload();this.uploadFile.clearQueue();if(this.template_id&&!A){this.readPermissionsTab.setAcl(C.result.acl_read);this.writePermissionsTab.setAcl(C.result.acl_write)}if(A){this.templateDialog.hide()}},failure:function(B,C){if(C.failureType!="client"){Ext.MessageBox.alert(GO.lang.strError,C.result.feedback)}},scope:this})}});GO.files.filesTemplate='<tpl if="files.length"><table class="display-panel" cellpadding="0" cellspacing="0" border="0"><tr><td colspan="4" class="display-panel-heading">'+GO.files.lang.files+'</td></tr><tr><td class="table_header_links" style="width:100%">'+GO.lang.strName+'</td><td class="table_header_links" style="white-space:nowrap">'+GO.lang.strMtime+'</td></tr><tpl for="files"><tr><td><a class="go-grid-icon filetype-{extension}" href="#files_{[xindex-1]}">{name}</a></td><td style="white-space:nowrap">{mtime}</td></tr></tpl></tpl>';GO.files.filesTemplateConfig={getPath:function(A){return A.replace(/\'/g,"\\'")}};GO.files.ImageViewer=Ext.extend(Ext.Window,{originalImgSize:false,viewerImages:Array(),currentImgIndex:0,initComponent:function(){this.border=false;this.plain=true;this.maximizable=true;this.width=640;this.height=Ext.getBody().getHeight()-80;this.bodyStyle="text-align:center;vertical-align:middle";this.title="Image viewer";this.tbar=[this.previousButton=new Ext.Button({iconCls:"btn-left-arrow",text:GO.lang.cmdPrevious,handler:function(){this.loadImage(this.currentImgIndex-1)},scope:this}),this.nextButton=new Ext.Button({iconCls:"btn-right-arrow",text:GO.lang.cmdNext,handler:function(){this.loadImage(this.currentImgIndex+1)},scope:this}),"-",{iconCls:"btn-save",text:GO.lang.download,cls:"x-btn-text-icon",handler:function(){document.location.replace(this.imgEl.dom.src)},scope:this}];GO.files.ImageViewer.superclass.initComponent.call(this);this.on("resize",this.syncImgSize,this)},show:function(A,B){GO.files.ImageViewer.superclass.show.call(this);this.viewerImages=A;this.loadImage(B)},loadImage:function(A){this.body.mask(GO.lang.waitMsgLoad);this.setTitle(this.viewerImages[A].name);this.currentImgIndex=A;if(this.imgEl){this.imgEl.remove()}this.originalImgSize=false;this.imgEl=this.body.createChild({tag:"img",src:this.viewerImages[A].src,cls:"fs-img-viewer"});this.syncImgSize();this.previousButton.setDisabled(A==0);this.nextButton.setDisabled(A==(this.viewerImages.length-1))},syncImgSize:function(){if(this.imgEl){if(!this.imgEl.dom.complete){this.syncImgSize.defer(100,this)}else{var F=this.imgEl.getSize();var C=F.width/F.height;if(!this.originalImgSize){this.originalImgSize=F}var D={width:this.getInnerWidth(),height:this.getInnerHeight()};if(C>1){var A=this.originalImgSize.width>D.width?D.width:this.originalImgSize.width;this.imgEl.setWidth(A);var E=this.imgEl.getHeight()}else{var E=this.originalImgSize.height>D.height?D.height:this.originalImgSize.height;this.imgEl.setHeight(E)}var B=(D.height-E)/2;this.imgEl.setStyle("margin-top",B+"px");this.body.unmask()}}}});GO.files.ThumbsPanel=Ext.extend(Ext.Panel,{store:false,initComponent:function(){this.bbar=new Ext.PagingToolbar({cls:"go-paging-tb",store:this.store,pageSize:parseInt(GO.settings.max_rows_list),displayInfo:true,displayMsg:GO.lang.displayingItems,emptyMsg:GO.lang.strNoItems});var A=new Ext.XTemplate('<tpl for=".">','<div class="fs-thumb-wrap" id="{name}">','<div class="fs-thumb"><img src="{thumb_url}" title="{name}"></div>','<span class="x-editable">{shortName}</span></div>',"</tpl>",'<div class="x-clear"></div>');this.items=[this.view=new Ext.DataView({tpl:A,autoHeight:true,multiSelect:true,overClass:"fs-view-over",selectedClass:"fs-view-selected",itemSelector:"div.fs-thumb-wrap",prepareData:function(B){B.shortName=Ext.util.Format.ellipsis(B.name,20);return B}})];this.autoScroll=true;this.view.on("render",function(){var B=new GO.files.ThumbsDragZone(this.view,{containerScroll:true,ddGroup:"FilesDD"});var C=new GO.files.ThumbsDropZone(this.view,{notifyDrop:this.onNotifyDrop.createDelegate(this)})},this);this.addEvents({drop:true});GO.files.ThumbsPanel.superclass.initComponent.call(this)},onBeforeLoad:function(){this.body.mask(GO.lang.waitMsgLoad)},onStoreLoad:function(){this.body.unmask()},setStore:function(A){if(this.store){this.store.un("beforeload",this.onBeforeLoad,this);this.store.un("load",this.onStoreLoad,this);this.store=false}if(A){this.store=A;this.store.on("beforeload",this.onBeforeLoad,this);this.store.on("load",this.onStoreLoad,this)}this.view.setStore(this.store)},deleteSelected:function(C){if(!C){C=this.deleteConfig}if(!C.deleteParam){C.deleteParam="delete_keys"}var E=[];var B=this.view.getSelectedRecords();for(var D=0;D<B.length;D++){E.push(B[D].data.type_id)}var F={};F[C.deleteParam]=Ext.encode(E);var A={store:this.store,params:F,count:E.length};if(C.callback){A.callback=C.callback}if(C.success){A.success=C.success}if(C.failure){A.failure=C.failure}if(C.scope){A.scope=C.scope}GO.deleteItems(A)},onNotifyDrop:function(A,E,C){var D=A.getDragData(E);if(A.dragData){var B=this.view.store.getAt(D.ddel.viewIndex);if(B&&B.data.extension=="folder"){this.fireEvent("drop",B.data.id,C.selections);return true}}}});GO.files.ThumbsDropZone=function(A,B){this.view=A;GO.files.ThumbsDropZone.superclass.constructor.call(this,A.getEl(),B)};Ext.extend(GO.files.ThumbsDropZone,Ext.dd.DropTarget,{ddGroup:"FilesDD",copy:false,notifyOver:function(A,E,C){var D=E.getTarget(".fs-thumb-wrap");if(D){var B=this.view.store.getAt(D.viewIndex);if(B){if(B.data.extension=="folder"){return this.dropAllowed}}}return false}});GO.files.ThumbsDragZone=function(A,B){this.view=A;GO.files.ThumbsDragZone.superclass.constructor.call(this,A.getEl(),B)};Ext.extend(GO.files.ThumbsDragZone,Ext.dd.DragZone,{ddGroup:"FilesDD",getDragData:function(H){if(H.ctrlKey){return false}var I=H.getTarget(".fs-thumb-wrap");if(I){var J=this.view;if(!J.isSelected(I)){J.onClick(H)}var B=J.getSelectedNodes();var C=J.getSelectedRecords();var D={nodes:B,selections:C};if(B.length==1){D.ddel=I;D.single=true}else{var A=document.createElement("div");A.className="multi-proxy";for(var E=0,G=B.length;E<G;E++){A.appendChild(B[E].firstChild.firstChild.cloneNode(true));if((E+1)%3==0){A.appendChild(document.createElement("br"))}}var F=document.createElement("div");F.innerHTML=E+" images selected";A.appendChild(F);D.ddel=A;D.multi=true}return D}return false},afterRepair:function(){for(var B=0,A=this.dragData.nodes.length;B<A;B++){Ext.fly(this.dragData.nodes[B]).frame("#8db2e3",1)}this.dragging=false},getRepairXY:function(B){if(!this.dragData.multi){var A=Ext.Element.fly(this.dragData.ddel).getXY();A[0]+=3;A[1]+=3;return A}return false}});GO.files.SaveAsDialog=Ext.extend(Ext.Window,{handler:function(){},initComponent:function(){this.layout="border";this.title=GO.files.lang.saveFile;this.height=450;this.width=700;this.border=false;this.collapsible=true;this.maximizable=true;this.closeAction="hide";this.buttons=[{text:GO.lang.cmdOk,handler:function(){var D=this.fb.gridStore.getRange();for(var C=0;C<D.length;C++){if(D[C].data.extension!="folder"&&D[C].data.name==this.nameField.getValue()){var B=new Ext.Template(GO.files.lang.confirmOverwrite);if(!confirm(B.apply({filename:D[C].data.name}))){return false}break}}this.handler.call(this.scope,this,this.fb.folder_id,this.nameField.getValue())},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];this.fb=new GO.files.FileBrowser({region:"center",border:false,loadDelayed:true,hideActionButtons:true,treeCollapsed:true,fileClickHandler:function(B){},scope:this});this.fb.on("fileselected",function(C,B){if(B.data.extension!="folder"){this.formPanel.form.findField("filename").setValue(B.data.name)}},this);this.nameField=new Ext.form.TextField({fieldLabel:GO.lang.strName,name:"filename",anchor:"100%",validator:function(B){return !B.match(/[&\/:\*\?"<>|\\]/)}});var A=function(){this.nameField.focus(true)};this.focus=A.createDelegate(this);this.formPanel=new Ext.form.FormPanel({region:"north",cls:"go-form-panel",height:32,items:this.nameField});this.items=[this.fb,this.formPanel];GO.files.SaveAsDialog.superclass.initComponent.call(this)},show:function(A){this.nameField.setValue(A.filename.replace(/[&\/:\*\?"<>|\\]/g,""));var B=GO.util.getFileExtension(A.filename);this.fb.setFilesFilter(B);if(!A.scope){A.scope=this}if(A.handler){this.handler=A.handler.createDelegate(A.scope)}GO.files.SaveAsDialog.superclass.show.call(this)}});GO.files.VersionsGrid=function(A){if(!A){A={}}A.title=GO.files.lang.olderVersions;A.layout="fit";A.autoScroll=true;A.split=true;A.store=new GO.data.JsonStore({url:GO.settings.modules.files.url+"json.php",baseParams:{task:"versions"},root:"results",totalProperty:"total",id:"path",fields:["path","name","type","size","mtime","grid_display","extension","timestamp","thumb_url"],remoteSort:true});var C=Ext.id();A.paging=true;var B=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"grid_display",sortable:true,id:C},{header:GO.lang.strSize,dataIndex:"size",width:80,sortable:true},{header:GO.lang.strMtime,dataIndex:"mtime",sortable:true,width:100}]);B.defaultSortable=true;A.cm=B;A.autoExpandColumn=C;A.view=new Ext.grid.GridView({emptyText:GO.lang.strNoItems});A.sm=new Ext.grid.RowSelectionModel();A.loadMask=true;GO.files.VersionsGrid.superclass.constructor.call(this,A);this.on("rowdblclick",function(E,F){var D=E.getStore().getAt(F);GO.files.openFile(D)},this)};Ext.extend(GO.files.VersionsGrid,GO.grid.GridPanel,{onShow:function(){GO.files.VersionsGrid.superclass.onShow.call(this);this.store.load()},setFileID:function(A){this.store.baseParams.file_id=A;this.store.loaded=false}});GO.files.NewFolderDialog=function(A){if(!A){A={}}this.newFolderNameField=new Ext.form.TextField({fieldLabel:GO.lang.strName,name:"name",value:"New folder",allowBlank:false,anchor:"100%",validator:function(C){return !C.match(/[&\/:\*\?"<>|\\]/)}});this.newFolderFormPanel=new Ext.form.FormPanel({url:GO.settings.modules.files.url+"action.php",baseParams:{folder_id:0},defaultType:"textfield",labelWidth:75,autoHeight:true,cls:"go-form-panel",waitMsgTarget:true,items:this.newFolderNameField});var B=function(){this.newFolderNameField.focus(true)};A.collapsible=false;A.maximizable=false;A.modal=false;A.resizable=false;A.width=500;A.items=this.newFolderFormPanel;A.autoHeight=true;A.closeAction="hide";A.focus=B.createDelegate(this);A.title=GO.files.lang.addFolder;A.buttons=[{text:GO.lang.cmdOk,handler:function(){this.newFolderFormPanel.form.submit({url:GO.settings.modules.files.url+"action.php",params:{task:"new_folder"},waitMsg:GO.lang.waitMsgSave,success:function(C,D){this.fireEvent("save",D.result);this.hide()},failure:function(D,E){var C="";if(E.failureType=="client"){C=GO.lang.strErrorsInForm}else{C=E.result.feedback}Ext.MessageBox.alert(GO.lang.strError,C)},scope:this})},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.files.NewFolderDialog.superclass.constructor.call(this,A);this.addEvents({save:true})};Ext.extend(GO.files.NewFolderDialog,Ext.Window,{show:function(A){if(!this.rendered){this.render(Ext.getBody())}this.newFolderFormPanel.baseParams.folder_id=A;this.newFolderFormPanel.form.reset();GO.files.NewFolderDialog.superclass.show.call(this)}});GO.files.UploadDialog=function(A){if(!A){A={}}this.uploadFile=new GO.form.UploadFile({inputName:"attachments",addText:GO.lang.smallUpload});this.upForm=new Ext.form.FormPanel({fileUpload:true,waitMsgTarget:true,baseParams:{task:"upload"},items:[this.uploadFile,new Ext.Button({text:GO.lang.largeUpload,handler:function(){if(!deployJava.isWebStartInstalled("1.5.0")){Ext.MessageBox.alert(GO.lang.strError,GO.lang.noJava)}else{window.open(GO.settings.modules.files.url+"jupload/index.php?id="+this.folder_id);this.hide()}},scope:this})],cls:"go-form-panel"});A.collapsible=false;A.maximizable=false;A.modal=false;A.resizable=false;A.width=300;A.items=this.upForm;A.autoHeight=true;A.closeAction="hide";A.title=GO.lang.uploadFiles;A.buttons=[{text:GO.lang.cmdOk,handler:this.uploadHandler,scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.files.UploadDialog.superclass.constructor.call(this,A);this.addEvents({upload:true})};Ext.extend(GO.files.UploadDialog,Ext.Window,{show:function(A){if(!this.rendered){this.render(Ext.getBody())}this.folder_id=A;GO.files.UploadDialog.superclass.show.call(this)},uploadHandler:function(){this.upForm.form.submit({url:GO.settings.modules.files.url+"action.php",success:function(A,B){this.uploadFile.clearQueue();this.hide();this.fireEvent("upload",B)},failure:function(B,C){var A="";if(C.failureType=="client"){A=GO.lang.strErrorsInForm}else{A=C.result.feedback}Ext.MessageBox.alert(GO.lang.strError,A)},scope:this})}});Ext.namespace("GO.files");GO.files.FileRecord=Ext.data.Record.create([{name:"type_id",type:"string"},{name:"id",type:"string"},{name:"name",type:"string"},{name:"type",type:"string"},{name:"mtime"},{name:"extension"},{name:"timestamp"},{name:"thumb_url",type:"string"}]);GO.files.FileBrowser=function(A){if(!A){A={}}this.treeLoader=new Ext.tree.TreeLoader({dataUrl:GO.settings.modules.files.url+"json.php",baseParams:{task:"tree",root_folder_id:0},preloadChildren:true});this.treePanel=new Ext.tree.TreePanel({region:"west",title:GO.lang.locations,layout:"fit",split:true,autoScroll:true,width:200,animate:true,loader:this.treeLoader,collapsed:A.treeCollapsed,rootVisible:false,containerScroll:true,collapsible:true,ddAppendOnly:true,containerScroll:true,ddGroup:"FilesDD",enableDD:true,selModel:new Ext.tree.MultiSelectionModel()});this.rootNode=new Ext.tree.AsyncTreeNode({text:"",draggable:false,id:"root",iconCls:"folder-default"});this.rootNode.on("load",function(C){if(!this.folder_id){this.folder_id=C.childNodes[0].id}this.setFolderID(this.folder_id)},this);this.treePanel.setRootNode(this.rootNode);this.treePanel.on("click",function(C){this.setFolderID(C.id,true)},this);this.treePanel.on("contextmenu",function(E,G){G.stopEvent();var D=this.treePanel.getSelectionModel();if(!D.isSelected(E)){D.clearSelections();D.select(E)}var C=this.getSelectedTreeRecords();var F=G.getXY();this.filesContextMenu.showAt(F,C,"tree")},this);this.treePanel.on("beforenodedrop",function(E){if(E.data.selections){var D=E.data.selections}else{var C={};C.data={};C.data.extension="folder";C.data.id=E.data.node.id;C.data.type_id="d:"+E.data.node.id;var D=[C]}this.paste("cut",E.target.id,D)},this);this.treePanel.on("nodedragover",function(F){if(!F.dropNode){for(var D=0;D<F.data.selections.length;D++){if(F.data.selections[D].data.extension=="folder"){var G=F.data.selections[D].data.id;var C=F.target.id;if(G==C){return false}var E=this.treePanel.getNodeById(G);if(F.target.isAncestor(E)){return false}return true}}}},this);this.gridStore=new GO.data.JsonStore({url:GO.settings.modules.files.url+"json.php",baseParams:{task:"grid"},root:"results",totalProperty:"total",id:"type_id",fields:["type_id","id","name","type","size","mtime","extension","timestamp","thumb_url","path","acl_read"],remoteSort:true});this.gridStore.on("load",this.onStoreLoad,this);if(A.filesFilter){this.setFilesFilter(A.filesFilter)}this.gridPanel=new GO.grid.GridPanel({layout:"fit",split:true,store:this.gridStore,paging:true,deleteConfig:{scope:this,success:function(){var C=this.treePanel.getNodeById(this.folder_id);if(C){C.reload()}}},columns:[{header:GO.lang.strName,dataIndex:"name",renderer:function(D,F,E){var C=E.get("acl_read")>0?"folder-shared":"filetype filetype-"+E.get("extension");return'<div class="go-grid-icon '+C+'">'+D+"</div>"},sortable:true},{header:GO.lang.strType,dataIndex:"type",sortable:false},{header:GO.lang.strSize,dataIndex:"size",sortable:true,renderer:function(C){return C=="-"?C:Ext.util.Format.fileSize(C)}},{header:GO.lang.strMtime,dataIndex:"mtime",sortable:true}],view:new Ext.grid.GridView({autoFill:true,forceFit:true}),sm:new Ext.grid.RowSelectionModel(),loadMask:true,enableDragDrop:true,ddGroup:"FilesDD"});this.gridPanel.on("delayedrowselect",function(C,E,D){this.fireEvent("fileselected",this,D)},this);this.gridPanel.on("render",function(){var C=new Ext.dd.DropTarget(this.gridPanel.getView().mainBody,{ddGroup:"FilesDD",copy:false,notifyOver:this.onGridNotifyOver,notifyDrop:this.onGridNotifyDrop.createDelegate(this)})},this);this.gridPanel.on("rowdblclick",this.onGridDoubleClick,this);this.filesContextMenu=new GO.files.FilesContextMenu();this.filesContextMenu.on("properties",function(D,C){this.showPropertiesDialog(C[0])},this);this.filesContextMenu.on("cut",function(D,C){this.onCutCopy("cut",C)},this);this.filesContextMenu.on("copy",function(D,C){this.onCutCopy("copy",C)},this);this.filesContextMenu.on("delete",function(E,D,C){this.onDelete(C)},this);this.filesContextMenu.on("compress",function(E,D,C){this.onCompress(D)},this);this.filesContextMenu.on("decompress",function(D,C){this.onDecompress(C)},this);this.gridPanel.on("rowcontextmenu",this.onGridRowContextMenu,this);this.newMenu=new Ext.menu.Menu({items:[]});this.newButton=new Ext.Button({text:GO.lang.cmdNew,iconCls:"btn-add",menu:this.newMenu});this.locationTextField=new Ext.form.TextField({fieldLabel:GO.lang.strLocation,name:"files-location",anchor:"100%"});this.locationPanel=new Ext.Panel({region:"north",layout:"form",border:false,baseCls:"x-plain",height:32,labelWidth:75,plain:true,cls:"go-files-location-panel",items:this.locationTextField});this.upButton=new Ext.Button({iconCls:"btn-up",text:GO.lang.up,cls:"x-btn-text-icon",handler:function(){this.setFolderID(this.parentID)},scope:this,disabled:true});this.pasteButton=new Ext.Button({iconCls:"btn-paste",text:GO.lang.paste,cls:"x-btn-text-icon",handler:this.onPaste,scope:this,disabled:true});this.uploadButton=new Ext.Button({iconCls:"btn-upload",text:GO.lang.upload,cls:"x-btn-text-icon",handler:function(){if(!this.uploadDialog){this.uploadDialog=new GO.files.UploadDialog();this.uploadDialog.on("upload",function(){this.sendOverwrite({folder_id:this.folder_id,task:"overwrite"})},this)}GO.currentFilesStore=this.gridStore;this.uploadDialog.show(this.folder_id)},scope:this});this.deleteButton=new Ext.Button({iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.onDelete("grid")},scope:this});this.cutButton=new Ext.Button({iconCls:"btn-cut",text:GO.lang.cut,cls:"x-btn-text-icon",handler:function(){var C=this.getSelectedGridRecords();this.onCutCopy("cut",C)},scope:this});this.copyButton=new Ext.Button({iconCls:"btn-copy",text:GO.lang.copy,cls:"x-btn-text-icon",handler:function(){var C=this.getSelectedGridRecords();this.onCutCopy("copy",C)},scope:this});this.emptyListButton=new Ext.Button({iconCls:"btn-refresh",text:GO.files.lang.emptyList,cls:"x-btn-text-icon",hidden:true,handler:function(){this.gridStore.baseParams.empty_new_files=true;this.gridStore.load();delete this.gridStore.baseParams.empty_new_files},scope:this});var B=[];if(!A.hideActionButtons){B.push(this.newButton);B.push(this.uploadButton);B.push("-")}B.push(this.upButton);B.push({iconCls:"btn-refresh",text:GO.lang.cmdRefresh,handler:function(){this.refresh()},scope:this});if(!A.hideActionButtons){B.push("-");B.push(this.copyButton);B.push(this.cutButton);B.push(this.pasteButton);B.push("-");B.push(this.deleteButton);B.push("-")}B.push(this.thumbsToggle=new Ext.Button({text:GO.files.lang.thumbnails,iconCls:"btn-thumbnails",enableToggle:true,toggleHandler:function(D,E){if(E){this.thumbsPanel.setStore(this.gridStore);this.cardPanel.getLayout().setActiveItem(1)}else{this.thumbsPanel.setStore(false);this.cardPanel.getLayout().setActiveItem(0)}var C=this.gridStore.reader.jsonData.thumbs=="1";if(C!=E){Ext.Ajax.request({url:GO.settings.modules.files.url+"action.php",params:{task:"set_view",id:this.folder_id,thumbs:E?"1":"0"}})}},scope:this}));if(!A.hideActionButtons){B.push("-");B.push(this.emptyListButton)}A.keys=[{ctrl:true,key:Ext.EventObject.C,fn:function(){var C=this.getSelectedGridRecords();this.onCutCopy("copy",C)},scope:this},{ctrl:true,key:Ext.EventObject.X,fn:function(){var C=this.getSelectedGridRecords();this.onCutCopy("cut",C)},scope:this},{ctrl:true,key:Ext.EventObject.V,fn:function(){this.onPaste()},scope:this}];A.layout="border";A.tbar=new Ext.Toolbar({cls:"go-head-tb",items:B});this.thumbsPanel=new GO.files.ThumbsPanel({store:this.gridStore});this.thumbsPanel.view.on("click",function(D,E,F,G){var C=D.store.getAt(E);this.fireEvent("fileselected",this,C)},this);this.thumbsPanel.view.on("dblclick",function(D,E,F,G){var C=D.store.getAt(E);this.fireEvent("filedblclicked",this,C);if(C.data.extension=="folder"){this.setFolderID(C.data.id,true)}else{if(this.fileClickHandler){this.fileClickHandler.call(this.scope,C)}else{GO.files.openFile(C,this.getActiveGridStore())}}},this);this.thumbsPanel.view.on("contextmenu",function(C,E,F,H){if(!C.isSelected(E)){C.clearSelections();C.selectRange(E,E)}var D=C.getSelectedRecords();H.stopEvent();this.contextTreeID=F.id;var G=H.getXY();this.filesContextMenu.showAt(G,D)},this);this.thumbsPanel.on("drop",function(D,C){this.paste("cut",D,C)},this);this.cardPanel=new Ext.Panel({region:"center",layout:"card",activeItem:0,deferredRender:false,border:false,anchor:"100% 100%",items:[this.gridPanel,this.thumbsPanel]});A.items=[this.locationPanel,this.treePanel,this.cardPanel];GO.files.FileBrowser.superclass.constructor.call(this,A);this.addEvents({fileselected:true,filedblclicked:true})};Ext.extend(GO.files.FileBrowser,Ext.Panel,{fileClickHandler:false,scope:this,pasteSelections:Array(),pasteMode:"cut",onStoreLoad:function(B){if(!GO.util.empty(B.reader.jsonData.feedback)){alert(B.reader.jsonData.feedback)}this.setWritePermission(B.reader.jsonData.write_permission);this.thumbsToggle.toggle(B.reader.jsonData.thumbs=="1");if(this.folder_id=="new"){var A=B.reader.jsonData.num_files;var C=this.treePanel.getNodeById("new");if(C){C.setText(GO.files.lang.newFiles+" ("+A+")")}}this.emptyListButton.setVisible(this.folder_id=="new"&&A>0);this.parentID=B.reader.jsonData.parent_id;if(this.parentID==0||!this.treePanel.getNodeById(this.parentID)){this.upButton.setDisabled(true)}else{this.upButton.setDisabled(false)}},setFileClickHandler:function(B,A){this.fileClickHandler=B;this.scope=A},setFilesFilter:function(A){this.gridStore.baseParams.files_filter=A},afterRender:function(){GO.files.FileBrowser.superclass.afterRender.call(this);GO.files.filePropertiesDialog.on("rename",function(B,A){if(this.folder_id==A){this.getActiveGridStore().load()}},this);GO.files.folderPropertiesDialog.on("rename",function(C,B){if(B==this.folder_id){this.setFolderID(B)}var A=this.treePanel.getNodeById(B);if(A){delete A.attributes.children;A.reload()}},this);this.buildNewMenu()},setRootID:function(B,A){this.folder_id=A;this.treeLoader.baseParams.root_folder_id=B;this.rootNode.reload()},buildNewMenu:function(){this.newMenu.removeAll();Ext.Ajax.request({url:GO.settings.modules.files.url+"json.php",params:{task:"templates"},callback:function(B,G,A){if(!G){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{this.newMenu.add({iconCls:"btn-add-folder",text:GO.lang.folder,cls:"x-btn-text-icon",handler:this.promptNewFolder,scope:this});var F=Ext.decode(A.responseText);if(F.results.length){this.newMenu.add("-");for(var C=0;C<F.results.length;C++){var E=F.results[C];var D=new Ext.menu.Item({iconCls:"filetype filetype-"+E.extension,text:E.name,template_id:E.id,handler:function(H){this.createFileFromTemplate(H.template_id)},scope:this});this.newMenu.add(D)}}if(GO.settings.modules.files.write_permission){this.newMenu.add("-");this.newMenu.add({iconCls:"btn-templates",text:GO.files.lang.manageTemplates,cls:"x-btn-text-icon",handler:function(){if(!this.templatesWindow){this.templatesWindow=new GO.files.TemplateWindow();this.templatesWindow.gridStore.on("datachanged",function(){if(!this.templatesWindow.firstLoad){this.buildNewMenu()}},this)}this.templatesWindow.show()},scope:this})}}},scope:this})},createFileFromTemplate:function(A,C){if(!C||C==""){Ext.Msg.prompt(GO.files.lang.enterName,GO.files.lang.pleaseEnterName,function(E,D){if(E=="cancel"){return false}else{this.createFileFromTemplate(A,D)}},this)}else{var B=this.getActiveGridStore();B.baseParams.template_id=A;B.baseParams.template_name=C;B.load({callback:function(){if(B.reader.jsonData.new_id){var D=B.getById("f:"+B.reader.jsonData.new_id);GO.files.openFile(D)}},scope:this});delete B.baseParams.template_id;delete B.baseParams.template_name}},onDecompress:function(B){var D=[];for(var C=0;C<B.length;C++){D.push(B[C].data.path)}if(D.length){var A=this.getActiveGridStore();A.baseParams.decompress_sources=Ext.encode(D);A.load({callback:function(){if(!A.reader.jsonData.decompress_success){Ext.Msg.alert(GO.lang.strError,A.reader.jsonData.decompress_feedback)}},scope:this});delete A.baseParams.decompress_sources}},onCompress:function(C,B){var E=[];for(var D=0;D<C.length;D++){E.push(C[D].data.path)}if(E.length){if(!B||B==""){Ext.Msg.prompt(GO.files.lang.enterName,GO.files.lang.pleaseEnterNameArchive,function(G,F){this.onCompress(C,F)},this)}else{var A=this.getActiveGridStore();A.baseParams.compress_sources=Ext.encode(E);A.baseParams.archive_name=B;A.load({callback:function(){if(!A.reader.jsonData.compress_success){Ext.Msg.alert(GO.lang.strError,A.reader.jsonData.compress_feedback)}},scope:this});delete A.baseParams.compress_sources;delete A.baseParams.archive_name}}},getSelectedTreeRecords:function(){var D=this.treePanel.getSelectionModel();var B=D.getSelectedNodes();var A=[];for(var C=0;C<B.length;C++){A.push({data:{type_id:"d:"+B[C].id,id:B[C].id,extension:"folder"}})}return A},getSelectedGridRecords:function(){if(this.cardPanel.getLayout().activeItem.selModel){var A=this.gridPanel.getSelectionModel();return A.getSelections()}else{return this.thumbsPanel.view.getSelectedRecords()}},getActiveGridStore:function(){return this.gridStore},onCutCopy:function(B,A){this.pasteSelections=A;this.pasteMode=B;if(this.pasteSelections.length){this.pasteButton.setDisabled(false)}},onPaste:function(){this.paste(this.pasteMode,this.folder_id,this.pasteSelections)},onDelete:function(A){if(A=="tree"){var B=this.getSelectedTreeRecords();GO.deleteItems({url:GO.settings.modules.files.url+"action.php",params:{task:"delete",id:B[0].data.id},count:1,callback:function(D){if(D.success){var C=this.treePanel.getNodeById(B[0].data.id);if(C){if(this.folder_id.indexOf(B[0].data.id)>-1||(C.parentNode&&C.parentNode.id==this.folder_id)){this.setFolderID(C.parentNode.id)}C.remove()}}},scope:this})}else{if(this.cardPanel.getLayout().activeItem.selModel){this.gridPanel.deleteSelected({callback:function(){var C=this.treePanel.getNodeById(this.folder_id);if(C){delete C.attributes.children;C.reload()}},scope:this})}else{this.thumbsPanel.deleteSelected({callback:function(){var C=this.treePanel.getNodeById(this.folder_id);if(C){delete C.attributes.children;C.reload()}},scope:this})}}},onGridNotifyOver:function(A,F,D){var E=A.getDragData(F);if(D.grid){var B=D.grid.store.data.items[E.rowIndex];if(B){if(B.data.extension=="folder"){for(var C=0;C<D.selections.length;C++){if(D.selections[C].data.id==B.data.id){return false}}return this.dropAllowed}}}return false},onGridNotifyDrop:function(A,G,E){if(E.grid){var H=E.grid.getSelectionModel();var D=H.getSelections();var F=A.getDragData(G);var B=E.grid.store.data.items[F.rowIndex];if(B.data.extension=="folder"){for(var C=0;C<E.selections.length;C++){if(E.selections[C].data.id==B.data.id){return false}}this.paste("cut",B.data.id,E.selections)}}else{return false}},onGridRowContextMenu:function(A,E,D){var B=A.getSelectionModel().getSelections();var C=D.getXY();this.filesContextMenu.showAt(C,B,"grid")},paste:function(E,A,B){var G=Array();var C=false;for(var D=0;D<B.length;D++){G.push(B[D].data.type_id);if(B[D].data.extension=="folder"){C=true}}var F={task:"paste",paste_sources:Ext.encode(G),paste_destination:A,paste_mode:E,id:this.folder_id};this.sendOverwrite(F)},refresh:function(){var A=this.treePanel.getNodeById(this.folder_id);this.treeLoader.baseParams.refresh_folder_id=this.folder_id;this.expandPath=false;if(A){this.expandPath=A.getPath()}this.rootNode.reload((function(){delete this.treeLoader.baseParams.refresh_folder_id;if(this.expandPath){this.treePanel.expandPath(this.expandPath)}}).createDelegate(this))},sendOverwrite:function(A){if(!A.command){A.command="ask"}this.overwriteParams=A;Ext.Ajax.request({url:GO.settings.modules.files.url+"action.php",params:this.overwriteParams,callback:function(M,J,E){var H=Ext.decode(this.overwriteParams.paste_sources);var L=this.overwriteParams.paste_destination;if(!J){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var C=Ext.decode(E.responseText);if(!C.success&&!C.file_exists){if(this.overwriteDialog){this.overwriteDialog.hide()}Ext.MessageBox.alert(GO.lang.strError,C.feedback);this.refresh()}else{if(C.file_exists){if(!this.overwriteDialog){this.overwriteDialog=new Ext.Window({width:500,autoHeight:true,closeable:false,closeAction:"hide",plain:true,border:false,title:GO.lang.fileExists,modal:false,buttons:[{text:GO.lang.cmdYes,handler:function(){this.overwriteParams.command="yes";this.sendOverwrite(this.overwriteParams)},scope:this},{text:GO.lang.cmdYesToAll,handler:function(){this.overwriteParams.command="yestoall";this.sendOverwrite(this.overwriteParams)},scope:this},{text:GO.lang.cmdNo,handler:function(){this.overwriteParams.command="no";this.sendOverwrite(this.overwriteParams)},scope:this},{text:GO.lang.cmdNoToAll,handler:function(){this.overwriteParams.command="notoall";this.sendOverwrite(this.overwriteParams)},scope:this},{text:GO.lang.cmdCancel,handler:function(){this.getActiveGridStore().reload();this.overwriteDialog.hide()},scope:this}]});this.overwriteDialog.render(Ext.getBody())}var K=new Ext.Template(GO.lang.overwriteFile);K.overwrite(this.overwriteDialog.body,{file:C.file_exists});this.overwriteDialog.show()}else{var I=this.getActiveGridStore();if(!L||L==this.folder_id){I.reload()}else{if(H){for(var F=0;F<H.length;F++){var G=I.getById(H[F]);if(G){I.reload();break}}}}var B=this.treePanel.getNodeById(L);if(B){delete B.attributes.children;B.reload()}if(H){for(var F=0;F<H.length;F++){var D=this.treePanel.getNodeById(H[F]);if(D){D.remove()}}}if(this.overwriteDialog){this.overwriteDialog.hide()}}}}},scope:this})},promptNewFolder:function(){if(!this.newFolderWindow){this.newFolderWindow=new GO.files.NewFolderDialog();this.newFolderWindow.on("save",function(){this.getActiveGridStore().reload();var A=this.treePanel.getNodeById(this.folder_id);if(A){delete A.attributes.children;A.reload()}},this)}this.newFolderWindow.show(this.folder_id)},onGridDoubleClick:function(C,D,E){var A=C.getSelectionModel();var B=A.getSelected();this.fireEvent("filedblclicked",this,B);if(B.data.extension=="folder"){this.setFolderID(B.data.id,true)}else{if(this.fileClickHandler){this.fileClickHandler.call(this.scope,B)}else{GO.files.openFile(B,this.getActiveGridStore())}}},setWritePermission:function(A){this.newButton.setDisabled(!A);this.deleteButton.setDisabled(!A);this.uploadButton.setDisabled(!A);this.cutButton.setDisabled(!A);this.pasteButton.setDisabled(!A||!this.pasteSelections.length)},setFolderID:function(B,A){this.folder_id=B;this.gridStore.baseParams.id=B;this.getActiveGridStore().load({callback:function(){var D=this.treePanel.getNodeById(B);if(D){this.treePanel.getSelectionModel().select(D);var C=new String();C=D.getPath("text");C=C.substring(2);this.locationTextField.setValue(C)}if(A){if(D){D.expand()}}this.focus()},scope:this})},showGridPropertiesDialog:function(){var A=this.gridPanel.getSelectionModel();var B=A.getSelections();if(B.length==0){Ext.Msg.alert(GO.lang.strError,GO.lang.noItemSelected)}else{if(B.length>1){Ext.Msg.alert(GO.lang.strError,GO.files.lang.errorOneItem)}else{this.showPropertiesDialog(B[0])}}},showPropertiesDialog:function(A){if(A.data.extension=="folder"){GO.files.folderPropertiesDialog.show(A.data.id)}else{GO.files.filePropertiesDialog.show(A.data.id)}}});GO.mainLayout.onReady(function(){GO.files.filePropertiesDialog=new GO.files.FilePropertiesDialog();GO.files.folderPropertiesDialog=new GO.files.FolderPropertiesDialog();if(GO.workflowLinkHandlers){GO.workflowLinkHandlers[6]=function(B,A){GO.files.filePropertiesDialog.show(B+"",{loadParams:{process_file_id:A}});GO.files.filePropertiesDialog.tabPanel.setActiveTab(3)}}});GO.files.openFile=function(B,C){var D=B.data.id?"id":"path";switch(B.data.extension){case"bmp":case"png":case"gif":case"jpg":case"jpeg":if(!this.imageViewer){this.imageViewer=new GO.files.ImageViewer({closeAction:"hide"})}var F=0;var A=Array();if(C){for(var E=0;E<C.data.items.length;E++){var G=C.data.items[E].data;if(G.extension=="jpg"||G.extension=="png"||G.extension=="gif"||G.extension=="bmp"||G.extension=="jpeg"){A.push({name:G.name,src:GO.settings.modules.files.url+"download.php?mode=download&"+D+"="+G[D]})}if(G[D]==B.get(D)){F=A.length-1}}}else{A.push({name:B.get("name"),src:GO.settings.modules.files.url+"download.php?mode=download&"+D+"="+B.get(D)})}this.imageViewer.show(A,F);break;case"dwg":case"doc":case"odt":case"ods":case"xls":case"ppt":case"odp":case"txt":if(D=="id"&&GO.settings.modules.gota&&GO.settings.modules.gota.read_permission){if(!GO.files.noJavaNotified&&!deployJava.isWebStartInstalled("1.6.0")){GO.files.noJavaNotified=true;Ext.MessageBox.alert(GO.lang.strError,GO.lang.noJava);window.location.href=GO.settings.modules.files.url+"download.php?mode=download&"+D+"="+B.get(D)}else{window.location.href=GO.settings.modules.gota.url+"jnlp.php?"+D+"="+B.get("id")}}else{window.location.href=GO.settings.modules.files.url+"download.php?mode=download&"+D+"="+B.get(D)}break;case"eml":if(GO.mailings){GO.linkHandlers[9].call(this,0,{path:B.data.path});break}default:window.location.href=GO.settings.modules.files.url+"download.php?mode=download&"+D+"="+B.get(D);break}};GO.files.openFolder=function(B,A){if(!GO.files.fileBrowser){GO.files.fileBrowser=new GO.files.FileBrowser({border:false,treeRootVisible:true,treeCollapsed:true});GO.files.fileBrowserWin=new Ext.Window({title:GO.files.lang.fileBrowser,height:500,width:740,layout:"fit",border:false,maximizable:true,collapsible:true,closeAction:"hide",items:GO.files.fileBrowser,buttons:[{text:GO.lang.cmdClose,handler:function(){GO.files.fileBrowserWin.hide()},scope:this}]})}GO.files.fileBrowser.setRootID(B,A);GO.files.fileBrowserWin.show();return GO.files.fileBrowser};GO.linkHandlers[6]=function(B,A){GO.files.filePropertiesDialog.show(B+"")};GO.moduleManager.addModule("files",GO.files.FileBrowser,{title:GO.files.lang.files,iconCls:"go-tab-icon-files"});