GO.addressbook.SelectCompany=function(A){Ext.apply(this,A);this.displayField="name";this.store=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"companies",addressbook_id:this.addressbook_id},root:"results",id:"id",totalProperty:"total",fields:["id","name","post_address","post_address_no","post_zip","post_city","post_state","post_country","vat_no","email"],remoteSort:true});this.store.setDefaultSort("name","asc");GO.addressbook.SelectCompany.superclass.constructor.call(this,{valueField:"id",triggerAction:"all",selectOnFocus:true,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.addressbook.SelectCompany,GO.form.ComboBoxReset);GO.addressbook.SelectContact=function(A){Ext.apply(this,A);this.displayField="name";this.store=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"contacts",addressbook_id:this.addressbook_id},root:"results",id:"id",totalProperty:"total",fields:["id","name","salutation","email"],remoteSort:true});this.store.setDefaultSort("name","asc");GO.addressbook.SelectContact.superclass.constructor.call(this,{valueField:"id",triggerAction:"all",selectOnFocus:true,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.addressbook.SelectContact,GO.form.ComboBoxReset);GO.addressbook.readableAddressbooksStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"addressbooks",auth_type:"read"},root:"results",totalProperty:"total",id:"id",fields:["id","name","owner"],remoteSort:true});GO.addressbook.writableAddressbooksStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"addressbooks",auth_type:"write"},root:"results",totalProperty:"total",id:"id",fields:["id","name","owner","acl_read","acl_write"],remoteSort:true});GO.addressbook.writableAddressbooksStore.on("load",function(){GO.addressbook.writableAddressbooksStore.on("load",function(){GO.addressbook.readableAddressbooksStore.load()})});GO.addressbook.ManageDialog=function(B){if(!B){B={}}this.addressbooksGrid=new GO.addressbook.ManageAddressbooksGrid();var A=[this.addressbooksGrid];if(GO.mailings){this.templatesGrid=new GO.mailings.TemplatesGrid();this.mailingsGrid=new GO.mailings.MailingsGrid();A.push(this.templatesGrid);A.push(this.mailingsGrid)}B.layout="fit";B.modal=false;B.shadow=false;B.border=false;B.height=450;B.width=800;B.closeAction="hide";B.title=GO.addressbook.lang.cmdManageDialog;B.items=[{xtype:"tabpanel",activeTab:0,border:true,items:A}];B.buttons=[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.addressbook.ManageDialog.superclass.constructor.call(this,B)};Ext.extend(GO.addressbook.ManageDialog,Ext.Window,{});GO.addressbook.ManageAddressbooksGrid=function(A){if(!A){A={}}A.title=GO.addressbook.lang.addressbooks;A.layout="fit";A.autoScroll=true;A.split=true;A.store=GO.addressbook.writableAddressbooksStore;A.paging=true;var B=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"name"},{header:GO.addressbook.lang.cmdOwner,dataIndex:"owner",sortable:false}]);B.defaultSortable=true;A.cm=B;A.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.addressbook.lang.noAddressbooks}),A.sm=new Ext.grid.RowSelectionModel();A.loadMask=true;this.addressbookDialog=new GO.addressbook.AddressbookDialog();this.addressbookDialog.on("save",function(){GO.addressbook.writableAddressbooksStore.load();GO.addressbook.readableAddressbooksStore.load()});A.tbar=[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.addressbookDialog.show()},disabled:!GO.settings.modules.addressbook.write_permission,scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.deleteSelected()},disabled:!GO.settings.modules.addressbook.write_permission,scope:this}];GO.addressbook.ManageAddressbooksGrid.superclass.constructor.call(this,A);this.on("rowdblclick",function(D,E){var C=D.getStore().getAt(E);this.addressbookDialog.show(C)},this)};Ext.extend(GO.addressbook.ManageAddressbooksGrid,GO.grid.GridPanel,{afterRender:function(){GO.addressbook.ManageAddressbooksGrid.superclass.afterRender.call(this);if(!GO.addressbook.writableAddressbooksStore.loaded){GO.addressbook.writableAddressbooksStore.load()}},onShow:function(){GO.addressbook.ManageAddressbooksGrid.superclass.onShow.call(this);if(!GO.addressbook.writableAddressbooksStore.loaded){GO.addressbook.writableAddressbooksStore.load()}}});GO.addressbook.AddressbookDialog=function(B){if(!B){B={}}this.buildForm();var A=function(){this.propertiesPanel.items.items[0].focus()};B.layout="fit";B.modal=false;B.shadow=false;B.border=false;B.height=450;B.width=800;B.closeAction="hide";B.title=GO.addressbook.lang.addressbook;B.items=this.tabPanel;this.buttons=[{text:GO.addressbook.lang.cmdUpload,handler:function(){this.uploadFile();if("csv"==this.addressbookImportPanel.form.items.items[0].getValue()){this.importDataSelectionWindow()}},hidden:true,scope:this},{text:GO.addressbook.lang.cmdExport,handler:function(){this.exportData()},hidden:true,scope:this},{text:GO.lang.cmdOk,handler:function(){this.saveAddressbook(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.saveAddressbook()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.addressbook.AddressbookDialog.superclass.constructor.call(this,B)};Ext.extend(GO.addressbook.AddressbookDialog,Ext.Window,{buildForm:function(A){this.propertiesPanel=new Ext.FormPanel({waitMsgTarget:true,title:GO.addressbook.lang.cmdPanelProperties,labelWidth:85,defaultType:"textfield",border:false,defaults:{anchor:"100%"},cls:"go-form-panel",waitMsgTarget:true,items:[{fieldLabel:GO.lang.strName,name:"name",allowBlank:false},this.selectUser=new GO.form.SelectUser({fieldLabel:GO.lang.strUser,disabled:!GO.settings.modules.addressbook["write_permission"],allowBlank:false})]});this.importfileTypeCombo=new Ext.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdFormLabelFileType,value:"csv",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["csv","CSV (Comma Separated Values)"],["vcf","VCF (vCard)"]]}),displayField:"text",valueField:"value",hiddenName:"import_filetype",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true});this.importfileTypeCombo.on("select",function(){switch(this.importfileTypeCombo.getValue()){case"vcf":this.importContactsCompaniesCombo.setDisabled(true);this.importValueSeperator.setDisabled(true);this.importValueIncluded.setDisabled(true);break;default:this.importContactsCompaniesCombo.setDisabled(false);this.importValueSeperator.setDisabled(false);this.importValueIncluded.setDisabled(false);break}},this);this.importfileInput=new Ext.form.TextField({autoCreate:{tag:"input",type:"file",size:"25",autocomplete:"off"},fieldLabel:"Select file",name:"import_file",inputType:"file",cls:"x-form-file x-form-field"});this.exportfileTypeCombo=new Ext.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdFormLabelFileType,value:"csv",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["csv","CSV (Comma Separated Values)"],["vcf","VCF (vCard)"]]}),displayField:"text",valueField:"value",hiddenName:"export_filetype",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true});this.exportfileTypeCombo.on("select",function(){switch(this.exportfileTypeCombo.getValue()){case"vcf":this.exportContactsCompaniesCombo.setDisabled(true);this.exportValueSeperator.setDisabled(true);this.exportValueIncluded.setDisabled(true);this.exportLinesEnded.setDisabled(true);break;default:this.exportContactsCompaniesCombo.setDisabled(false);this.exportValueSeperator.setDisabled(false);this.exportValueIncluded.setDisabled(false);this.exportLinesEnded.setDisabled(false);break}},this);this.importContactsCompaniesCombo=new Ext.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdImport,value:"contacts",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["contacts",GO.addressbook.lang.contacts],["companies",GO.addressbook.lang.companies]]}),displayField:"text",valueField:"value",hiddenName:"import_type",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true});this.exportContactsCompaniesCombo=new Ext.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdExport,value:"contacts",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["contacts",GO.addressbook.lang.contacts],["companies",GO.addressbook.lang.companies]]}),displayField:"text",valueField:"value",hiddenName:"export_type",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true});this.addressbookImportPanel=new Ext.FormPanel({waitMsgTarget:true,title:GO.addressbook.lang.cmdImport,labelWidth:150,defaultType:"textfield",fileUpload:true,border:false,defaults:{anchor:"100%"},cls:"go-form-panel",waitMsgTarget:true,items:[this.importfileTypeCombo,this.importfileInput,this.importContactsCompaniesCombo,this.importValueSeperator=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelValueSeperated,name:"separator",anchor:"",width:100,value:",",allowBlank:false}),this.importValueIncluded=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelValueIncluded,name:"quote",anchor:"",width:100,value:'"',allowBlank:false})]});this.addressbookExportPanel=new Ext.FormPanel({onSubmit:Ext.emptyFn,submit:function(){this.getEl().dom.submit()},title:GO.addressbook.lang.cmdExport,labelWidth:150,defaultType:"textfield",border:false,defaults:{anchor:"100%",allowBlank:false},cls:"go-form-panel",waitMsgTarget:true,items:[this.exportfileTypeCombo,this.exportContactsCompaniesCombo,this.exportValueSeperator=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelValueSeperated,name:"separator",anchor:"",width:100,value:",",allowBlank:false}),this.exportValueIncluded=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelValueIncluded,name:"quote",anchor:"",width:100,value:'"',allowBlank:false}),this.exportLinesEnded=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelLinesEnded,name:"crlf",anchor:"",width:100,value:"\\r\\n",allowBlank:false})]});this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,border:false,items:[this.propertiesPanel,this.addressbookImportPanel,this.addressbookExportPanel,this.readPermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strReadPermissions}),this.writePermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strWritePermissions})]});this.propertiesPanel.on("show",this.syncButtons,this);this.addressbookImportPanel.on("show",this.syncButtons,this);this.addressbookExportPanel.on("show",this.syncButtons,this);this.readPermissionsTab.on("show",this.syncButtons,this);this.writePermissionsTab.on("show",this.syncButtons,this)},syncButtons:function(){this.buttons[0].setVisible(this.addressbookImportPanel.isVisible());this.buttons[1].setVisible(this.addressbookExportPanel.isVisible());this.buttons[2].setVisible(this.propertiesPanel.isVisible());this.buttons[3].setVisible(this.propertiesPanel.isVisible())},show:function(A){if(!this.rendered){this.render(Ext.getBody())}if(A){this.record=A;this.addressbook_id=A.data.id}else{this.addressbook_id=0}this.tabPanel.setActiveTab(0);if(this.addressbook_id==0){this.propertiesPanel.form.reset();this.addressbookImportPanel.setDisabled(true);this.addressbookExportPanel.setDisabled(true);this.readPermissionsTab.setAcl(0);this.writePermissionsTab.setAcl(0)}else{this.propertiesPanel.form.findField("name").setValue(this.record.data.name);this.selectUser.setValue(this.record.data.user_id);this.selectUser.setRemoteText(this.record.data.owner);this.addressbookImportPanel.setDisabled(false);this.addressbookExportPanel.setDisabled(false);this.readPermissionsTab.setAcl(this.record.data.acl_read);this.writePermissionsTab.setAcl(this.record.data.acl_write)}GO.addressbook.AddressbookDialog.superclass.show.call(this);this.propertiesPanel.form.clearInvalid();this.syncButtons()},importDataSelectionWindow:function(){switch(this.addressbookImportPanel.form.items.items[2].getValue()){case"contacts":var C="2";this.defaultCSVField={title:GO.lang.strTitle,first_name:GO.lang.strFirstName,middle_name:GO.lang.strMiddleName,last_name:GO.lang.strLastName,initials:GO.lang.strInitials,sex:GO.lang.strSex,birthday:GO.lang.strBirthday,address:GO.lang.strAddress,address_no:GO.lang.strAddressNo,zip:GO.lang.strZip,city:GO.lang.strCity,state:GO.lang.strState,country:GO.lang.strCountry,email:GO.lang.strEmail,email2:GO.lang.strEmail+" 2",email3:GO.lang.strEmail+" 3",home_phone:GO.lang.strPhone,fax:GO.lang.strFax,work_phone:GO.lang.strWorkPhone,work_fax:GO.lang.strWorkFax,cellular:GO.lang.strCellular,company_name:GO.lang.strCompany,department:GO.lang.strDepartment,"function":GO.lang.strFunction,salutation:GO.lang.strSalutation,comment:GO.lang.strComment};break;case"companies":var C="3";this.defaultCSVField={name:GO.lang.strName,email:GO.lang.strEmail,phone:GO.lang.strPhone,fax:GO.lang.strFax,country:GO.lang.strCountry,state:GO.lang.strState,city:GO.lang.strCity,zip:GO.lang.strZip,address:GO.lang.strAddress,address_no:GO.lang.strAddressNo,post_country:GO.lang.strPostCountry,post_state:GO.lang.strPostState,post_city:GO.lang.strPostCity,post_zip:GO.lang.strPostZip,post_address:GO.lang.strPostAddress,post_address_no:GO.lang.strPostAddressNo,homepage:GO.lang.strHomepage,bank_no:GO.addressbook.lang.cmdFormLabelBankNo,vat_no:GO.addressbook.lang.cmdFormLabelVatNo};break}if(GO.customfields&&GO.customfields.types[C]&&GO.customfields.types[C].panels){for(var G=0;G<GO.customfields.types[C].panels.length;G++){var A=GO.customfields.types[C].panels[G].customfields;for(var E=0;E<A.length;E++){if(A[E].datatype!="heading"&&A[E].datatype!="function"){this.defaultCSVField[A[E].name]=A[E].label}}}}this.addressbookImportData=new Ext.form.FormPanel({waitMsgTarget:true,id:"addressbook-default-import-data-window",labelWidth:125,border:false,defaults:{anchor:"-20"},cls:"go-form-panel",autoScroll:true});this.csvFieldStore=new Ext.data.JsonStore({fields:["id","name"],root:"list_keys",id:"id"});this.csvFieldStore.on("load",function(){var H=this.addressbookImportData.items.items;for(var K=0;K<H.length;K++){var L=true;for(var J=0;J<H[K].store.data.items.length;J++){var M=H[K].store.data.items[J].data.name;var I=H[K].fieldLabel;if(M==I){H[K].setValue(H[K].store.data.items[J].data.id);L=false}}if(L){H[K].setValue(H[K].store.data.items[0].data.id)}}},this);for(var B in this.defaultCSVField){var F=new Ext.form.ComboBox({fieldLabel:this.defaultCSVField[B],id:"export_combo_"+B,store:this.csvFieldStore,displayField:"name",valueField:"id",hiddenName:B,mode:"local",triggerAction:"all",editable:false});this.addressbookImportData.add(F)}var D=[{text:GO.addressbook.lang.cmdImport,handler:this.importData,scope:this},{text:GO.lang.cmdClose,handler:function(){this.csvFieldDialog.close()},scope:this}];this.csvFieldDialog=new Ext.Window({layout:"fit",height:400,width:400,title:GO.addressbook.lang.matchFields,items:[this.addressbookImportData],buttons:D});this.csvFieldDialog.show()},saveAddressbook:function(A){this.propertiesPanel.form.submit({waitMsg:GO.lang.waitMsgSave,url:GO.settings.modules.addressbook.url+"action.php",params:{task:"save_addressbook",addressbook_id:this.addressbook_id},success:function(B,C){GO.addressbook.writableAddressbooksStore.reload();if(C.result.addressbook_id){this.addressbook_id=C.result.addressbook_id;this.addressbookImportPanel.setDisabled(false);this.addressbookExportPanel.setDisabled(false);this.readPermissionsTab.setAcl(C.result.acl_read);this.writePermissionsTab.setAcl(C.result.acl_write)}if(A){this.hide()}},failure:function(B,C){if(C.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,C.result.feedback)}},scope:this})},uploadFile:function(){this.addressbookImportPanel.form.submit({url:GO.settings.modules.addressbook.url+"action.php",params:{task:"upload",addressbook_id:this.addressbook_id},success:function(A,B){if(this.addressbookImportPanel.form.items.items[0].getValue()=="csv"){this.csvFieldStore.loadData(B.result)}else{Ext.MessageBox.alert(GO.lang.strSuccess,GO.addressbook.lang.importSuccess)}},failure:function(B,A){if(A.failureType!="client"){Ext.MessageBox.alert(GO.lang.strError,A.result.feedback)}},scope:this})},importData:function(){this.addressbookImportData.form.submit({url:GO.settings.modules.addressbook.url+"action.php",waitMsg:GO.lang.waitMsgSave,params:{task:"import",addressbook_id:this.addressbook_id,separator:this.addressbookImportPanel.form.findField("separator").getValue(),quote:this.addressbookImportPanel.form.findField("quote").getValue(),import_type:this.addressbookImportPanel.form.items.items[2].getValue(),import_filetype:this.addressbookImportPanel.form.items.items[0].getValue()},success:function(A,B){if(this.csvFieldDialog){this.csvFieldDialog.close()}Ext.MessageBox.alert(GO.lang.strSuccess,GO.addressbook.lang.importSuccess)},failure:function(A,B){if(task.failureType!="client"){Ext.MessageBox.alert(GO.lang.strError,B.result.feedback)}},scope:this})},exportData:function(){this.addressbookExportPanel.form.el.set({action:GO.settings.modules.addressbook.url+"export.php?addressbook_id="+this.addressbook_id});this.addressbookExportPanel.form.submit()}});GO.addressbook.AddresbooksGrid=function(A){if(!A){A={}}A.title=GO.addressbook.lang.cmdPanelAddressbook;A.layout="fit";A.autoScroll=true;A.split=true;A.store=GO.addressbook.readableAddressbooksStore;A.ddGroup="AddressBooksDD";A.enableDD=true;GO.addressbook.readableAddressbooksStore.on("load",function(){this.selModel.selectFirstRow()},this);A.paging=false;var B=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"name"}]);B.defaultSortable=true;A.cm=B;A.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.addressbook.lang.noAddressbooks}),A.sm=new Ext.grid.RowSelectionModel();A.loadMask=true;GO.addressbook.AddresbooksGrid.superclass.constructor.call(this,A)};Ext.extend(GO.addressbook.AddresbooksGrid,GO.grid.GridPanel,{type:"",afterRender:function(){GO.addressbook.AddresbooksGrid.superclass.afterRender.call(this);var A=new Ext.dd.DropTarget(this.getView().mainBody,{ddGroup:"AddressBooksDD",notifyDrop:this.onNotifyDrop.createDelegate(this)})},setType:function(A){this.type=A},onNotifyDrop:function(A,H,F){var B=A.dragData.selections;var C=this.getView().findRowIndex(H.target);var G=this.getView().grid.store.data.items[C].id;var I=false;var D=[];for(var E=0;E<B.length;E++){D.push(B[E].id);if(B[E].json.company_id>0){I=true;company_id=B[E].json.company_id}}if(!I&&this.type=="company"){I=true}if(G>0&&(!I||confirm(GO.addressbook.lang.moveAll))){Ext.Ajax.request({url:GO.settings.modules.addressbook.url+"action.php",params:{task:"drop_"+this.type,book_id:G,items:Ext.encode(D)}});this.fireEvent("drop",this.type);return true}else{return false}}});GO.addressbook.ContactReadPanel=Ext.extend(GO.DisplayPanel,{link_type:2,loadParams:{task:"load_contact_with_items"},idParam:"contact_id",loadUrl:GO.settings.modules.addressbook.url+"json.php",editHandler:function(){GO.addressbook.contactDialog.show(this.data.id);this.addSaveHandler(GO.addressbook.contactDialog)},initComponent:function(){this.template='<table class="display-panel" cellpadding="0" cellspacing="0" border="0"><tr><td colspan="2" class="display-panel-heading">'+GO.addressbook.lang.cmdContactDetailsFor+' <b>{full_name}</b></td></tr><tr><td valign="top"><table cellpadding="0" cellspacing="0" border="0"><tr><td><tpl if="this.notEmpty(title)">{title} </tpl>{full_name}<tpl if="this.notEmpty(address) || this.notEmpty(address_no)"><br />{[this.GoogleMapsCityStreet(values)]}</tpl><tpl if="this.notEmpty(zip) || this.notEmpty(city)"><br />{zip} {city}</tpl><tpl if="this.notEmpty(state)"><br />{state}</tpl><tpl if="this.notEmpty(country)"><br />{country}</tpl></td></tr></table></td><td valign="top" class="contactCompanyDetailsPanelKolom"><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(initials)"><tr><td>'+GO.lang.strInitials+':</td><td> {initials}</td></tr></tpl><tpl if="this.notEmpty(birthday)"><tr><td>'+GO.lang.strBirthday+':</td><td> {birthday}</td></tr></tpl></table></td></tr><tpl if="this.isContactFieldset(values)"><tr><td colspan="2" class="display-panel-heading">'+GO.addressbook.lang.cmdFieldsetContact+'</td></tr><tr><td valign="top" class="contactCompanyDetailsPanelKolom60"><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(email)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strEmail+':</td><td>{[this.mailTo(values.email, values.full_name)]}</td></tr></tpl><tpl if="this.notEmpty(email2)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strEmail+' 2:</td><td>{[this.mailTo(values.email2, values.full_name)]}</td></tr></tpl><tpl if="this.notEmpty(email3)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strEmail+' 3:</td><td>{[this.mailTo(values.email3, values.full_name)]}</td></tr></tpl><tpl if="this.isPhoneFieldset(values)"><tr><td colspan="2">&nbsp;</td></tr><tpl if="this.notEmpty(home_phone)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strPhone+':</td><td><a href="callto:{home_phone}+type=phone">{home_phone}</a></td></tr></tpl><tpl if="this.notEmpty(cellular)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strCellular+':</td><td><a href="callto:{cellular}+type=phone">{cellular}</a></td></tr></tpl><tpl if="this.notEmpty(fax)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strFax+':</td><td>{fax}</td></tr></tpl></tpl></table></td><tpl if="this.isWorkPhoneFieldset(values)"><td valign="top" class="contactCompanyDetailsPanelKolom40"><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(work_phone)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strWorkPhone+':</td><td><a href="callto:{work_phone}+type=phone">{work_phone}</a></td></tr></tpl><tpl if="this.notEmpty(work_fax)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strWorkFax+':</td><td>{work_fax}</td></tr></tpl></table></td></tpl></tr></tpl><tpl if="this.isWorkFieldset(values)"><tr><td colspan="2" class="display-panel-heading">'+GO.addressbook.lang.cmdFieldsetWork+'</td></tr><tr><td colspan="2" valign="top" class="contactCompanyDetailsPanelKolom60"><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(company_name)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strCompany+':</td><td><a href="#" onclick="GO.linkHandlers[3].call(this,{company_id});">{company_name}</a></td></tr></tpl><tpl if="this.notEmpty(values[\'function\'])"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strFunction+':</td><td>{function}</td></tr></tpl><tpl if="this.notEmpty(department)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strDepartment+':</td><td>{department}</td></tr></tpl></table></td></tr></tpl><tpl if="this.notEmpty(values[\'comment\'])"><tr><td class="display-panel-heading" colspan="2">'+GO.addressbook.lang.cmdFormLabelComment+'</td></tr><tr><td colspan="2">{comment}</td></tr></tpl></table>'+GO.linksTemplate;if(GO.customfields){this.template+=GO.customfields.displayPanelTemplate}Ext.apply(this.templateConfig,{addSlashes:function(A){A=GO.util.html_entity_decode(A,"ENT_QUOTES");A=GO.util.add_slashes(A);return A},mailTo:function(B,A){if(GO.email&&GO.settings.modules.email.read_permission){return'<a href="#" onclick="GO.email.showAddressMenu(event, \''+this.addSlashes(B)+"','"+this.addSlashes(A)+"');\">"+B+"</a>"}else{return'<a href="mailto:'+B+'">'+B+"</a>"}},isContactFieldset:function(A){if(this.notEmpty(A.email)||this.notEmpty(A.email2)||this.notEmpty(A.email3)||this.notEmpty(A.home_phone)||this.notEmpty(A.fax)||this.notEmpty(A.cellular)||this.notEmpty(A.work_phone)||this.notEmpty(A.work_fax)){return true}else{return false}},isPhoneFieldset:function(A){if(this.notEmpty(A.home_phone)||this.notEmpty(A.fax)||this.notEmpty(A.cellular)){return true}else{return false}},isWorkPhoneFieldset:function(A){if(this.notEmpty(A.work_phone)||this.notEmpty(A.work_fax)){return true}else{return false}},isWorkFieldset:function(A){if(this.notEmpty(A.company_name)||this.notEmpty(A["function"])||this.notEmpty(A.department)){return true}else{return false}},GoogleMapsCityStreet:function(A){var B="http://maps.google.com/maps?q=";if(this.notEmpty(A.address)&&this.notEmpty(A.city)){if(this.notEmpty(A.address_no)){return'<a href="'+B+A.address+"+"+A.address_no+"+"+A.city+'" target="_blank" >'+A.address+" "+A.address_no+"</a>"}else{return'<a href="'+B+A.address+"+"+A.city+'" target="_blank" >'+A.address+"</a>"}}else{return A.address+" "+A.address_no}}});Ext.apply(this.templateConfig,GO.linksTemplateConfig);if(GO.files){Ext.apply(this.templateConfig,GO.files.filesTemplateConfig);this.template+=GO.files.filesTemplate}if(GO.comments){this.template+=GO.comments.displayPanelTemplate}GO.addressbook.ContactReadPanel.superclass.initComponent.call(this);if(GO.mailings){this.newOODoc=new GO.mailings.NewOODocumentMenuItem();this.newOODoc.on("create",function(){this.reload()},this);this.newMenuButton.menu.add(this.newOODoc);GO.mailings.ooTemplatesStore.on("load",function(){this.newOODoc.setDisabled(GO.mailings.ooTemplatesStore.getCount()==0)},this)}if(GO.tasks){this.scheduleCallItem=new GO.tasks.ScheduleCallMenuItem();this.newMenuButton.menu.add(this.scheduleCallItem)}},getLinkName:function(){return this.data.full_name},setData:function(B){GO.addressbook.ContactReadPanel.superclass.setData.call(this,B);if(GO.mailings&&!GO.mailings.ooTemplatesStore.loaded){GO.mailings.ooTemplatesStore.load()}if(B.write_permission){if(this.scheduleCallItem){var A=this.data.full_name;if(this.data.work_phone!=""){A+=" ("+this.data.work_phone+")"}else{if(this.data.cellular!=""){A+=" ("+this.data.cellular+")"}else{if(this.data.home_phone!=""){A+=" ("+this.data.home_phone+")"}}}this.scheduleCallItem.setLinkConfig({name:A,links:[{link_id:this.data.id,link_type:2}],callback:this.reload,scope:this})}}}});GO.addressbook.CompanyReadPanel=Ext.extend(GO.DisplayPanel,{link_type:3,loadParams:{task:"load_company_with_items"},idParam:"company_id",loadUrl:GO.settings.modules.addressbook.url+"json.php",editHandler:function(){GO.addressbook.companyDialog.show(this.data.id);this.addSaveHandler(GO.addressbook.companyDialog)},initComponent:function(){this.template='<div><table class="display-panel" cellpadding="0" cellspacing="0" border="0"><tr><tpl if="this.isCompanySecondColumn(values)"><td colspan="2" valign="top" class="display-panel-heading"></tpl><tpl if="this.isCompanySecondColumn(values) == false"><td valign="top" class="display-panel-heading"></tpl>'+GO.addressbook.lang.cmdCompanyDetailsFor+' <b>{name}</b></td></tr><tr><tpl if="this.isCompanySecondColumn(values)"><tpl if="this.isBankVat(values)"><td valign="top" class="contactCompanyDetailsPanelKolom"></tpl><tpl if="this.isBankVat(values) == false"><td colspan="2" valign="top" class="contactCompanyDetailsPanelKolom100"></tpl></tpl><tpl if="this.isCompanySecondColumn(values) == false"><td valign="top" class="contactCompanyDetailsPanelKolom100"></tpl><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(phone)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strPhone+':</td><td><a href="callto:{phone}+type=phone">{phone}</a></td></tr></tpl><tpl if="this.notEmpty(fax)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strFax+':</td><td>{fax}</td></tr></tpl><tpl if="this.notEmpty(email)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strEmail+':</td><td>{[this.mailTo(values.email, values.full_name)]}</td></tr></tpl><tr><td colspan="2">&nbsp;</td></tr><tpl if="this.notEmpty(homepage)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strHomepage+':</td><td>&nbsp;<a href="{homepage}" target="_blank">{homepage}</a></td></tr></tpl></table></td><tpl if="this.isBankVat(values)"><td valign="top" class="contactCompanyDetailsPanelKolom"><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(bank_no)"><tr><td>'+GO.addressbook.lang.cmdFormLabelBankNo+':</td><td>&nbsp;{bank_no}</td></tr></tpl><tpl if="this.notEmpty(vat_no)"><tr><td>'+GO.addressbook.lang.cmdFormLabelVatNo+':</td><td> {vat_no}</td></tr></tpl></table></td></tpl></tr><tpl if="this.isAddress(values)"><tr><tpl if="this.isCompanySecondColumn(values)"><td colspan="2" valign="top" class="display-panel-heading"></tpl><tpl if="this.isCompanySecondColumn(values) == false"><td valign="top" class="display-panel-heading"></tpl>'+GO.addressbook.lang.cmdFieldsetContact+'</td></tr><tr><tpl if="this.isAddressVisit(values)"><tpl if="this.isCompanySecondColumn(values)"><tpl if="this.isAddressPost(values)"><td valign="top" class="contactCompanyDetailsPanelKolom"></tpl><tpl if="this.isAddressPost(values) == false"><td colspan="2" valign="top" class="contactCompanyDetailsPanelKolom100"></tpl></tpl><tpl if="this.isCompanySecondColumn(values) == false"><td valign="top" class="contactCompanyDetailsPanelKolom100"></tpl><table cellpadding="0" cellspacing="0" border="0"><tr><td colspan="2" class="readPanelSubHeading">'+GO.addressbook.lang.cmdFieldsetVisitAddress+'</td></tr><tr><td><tpl if="this.notEmpty(address) || this.notEmpty(address_no)">{[this.GoogleMapsCityStreet(values)]}</tpl><tpl if="this.notEmpty(zip) || this.notEmpty(city)"><br />{zip} {city}</tpl><tpl if="this.notEmpty(state)"><br />{state}</tpl><tpl if="this.notEmpty(country)"><br />{country}</tpl></table></td></tpl><tpl if="this.isAddressPost(values)"><tpl if="this.isAddressVisit(values)"><td valign="top" class="contactCompanyDetailsPanelKolom"></tpl><tpl if="this.isAddressVisit(values) == false"><td colspan="2" valign="top" class="contactCompanyDetailsPanelKolom100"></tpl><table cellpadding="0" cellspacing="0" border="0"><tr><td colspan="2" class="readPanelSubHeading">'+GO.addressbook.lang.cmdFieldsetPostAddress+'</td></tr><tr><td><tpl if="this.notEmpty(post_address) || this.notEmpty(post_address_no)">{post_address} {post_address_no}</tpl><tpl if="this.notEmpty(post_zip) || this.notEmpty(post_city)"><br />{post_zip} {post_city}</tpl><tpl if="this.notEmpty(post_state)"><br />{post_state}</tpl><tpl if="this.notEmpty(post_country)"><br />{post_country}</tpl></table></td></tpl></tr></tpl></table><tpl if="this.notEmpty(comment)"><table cellpadding="0" cellspacing="0" border="0" class="display-panel"><tr><td class="display-panel-heading">'+GO.addressbook.lang.cmdFormLabelComment+'</td></tr><tr><td>{comment}</td></tr></table></tpl><tpl if="employees.length"><table class="display-panel" cellpadding="0" cellspacing="0" border="0"><tr><td colspan="4" class="display-panel-heading">'+GO.addressbook.lang.cmdPanelEmployees+'</td></tr><tr><td width="16" class="display-panel-links-header">&nbsp;</td><td class="table_header_links">'+GO.lang.strName+'</td><td class="table_header_links">'+GO.lang.strEmail+'</td></tr><tpl for="employees"><tr><td><div class="go-icon go-link-icon-2"></div></td><td><a href="#" onclick="GO.linkHandlers[2].call(this, {id});">{name}</a></td><td>{[this.mailTo(values.email, values.name)]}</td></tr></tpl></tpl>'+GO.linksTemplate;if(GO.customfields){this.template+=GO.customfields.displayPanelTemplate}Ext.apply(this.templateConfig,{addSlashes:function(A){A=GO.util.html_entity_decode(A,"ENT_QUOTES");A=GO.util.add_slashes(A);return A},mailTo:function(B,A){if(GO.email&&GO.settings.modules.email.read_permission){return'<a href="#" onclick="GO.email.showAddressMenu(event, \''+this.addSlashes(B)+"','"+this.addSlashes(A)+"');\">"+B+"</a>"}else{return'<a href="mailto:'+B+'">'+B+"</a>"}},isCompanySecondColumn:function(A){if(this.isBankVat(A)||this.isAddressPost(A)){return true}else{return false}},isBankVat:function(A){if(this.notEmpty(A.bank_no)||this.notEmpty(A.vat_no)){return true}else{return false}},isAddress:function(A){if(this.notEmpty(A.address)||this.notEmpty(A.address_no)||this.notEmpty(A.zip)||this.notEmpty(A.city)||this.notEmpty(A.state)||this.notEmpty(A.country)||this.notEmpty(A.post_address)||this.notEmpty(A.post_address_no)||this.notEmpty(A.post_zip)||this.notEmpty(A.post_city)||this.notEmpty(A.post_state)||this.notEmpty(A.post_country)){return true}else{return false}},isAddressVisit:function(A){if(this.notEmpty(A.address)||this.notEmpty(A.address_no)||this.notEmpty(A.zip)||this.notEmpty(A.city)||this.notEmpty(A.state)||this.notEmpty(A.country)){return true}else{return false}},isAddressPost:function(A){if(this.notEmpty(A.post_address)||this.notEmpty(A.post_address_no)||this.notEmpty(A.post_zip)||this.notEmpty(A.post_city)||this.notEmpty(A.post_state)||this.notEmpty(A.post_country)){return true}else{return false}},GoogleMapsCityStreet:function(A){var B="http://maps.google.com/maps?q=";if(this.notEmpty(A.address)&&this.notEmpty(A.city)){if(this.notEmpty(A.address_no)){return'<a href="'+B+A.address+"+"+A.address_no+"+"+A.city+'" target="_blank" >'+A.address+" "+A.address_no+"</a>"}else{return'<a href="'+B+A.address+"+"+A.city+'" target="_blank" >'+A.address+"</a>"}}else{return A.address+" "+A.address_no}}});Ext.apply(this.templateConfig,GO.linksTemplateConfig);if(GO.files){Ext.apply(this.templateConfig,GO.files.filesTemplateConfig);this.template+=GO.files.filesTemplate}if(GO.comments){this.template+=GO.comments.displayPanelTemplate}this.template+="</div>";GO.addressbook.CompanyReadPanel.superclass.initComponent.call(this);if(GO.mailings){this.newOODoc=new GO.mailings.NewOODocumentMenuItem();this.newOODoc.on("create",function(){this.reload()},this);this.newMenuButton.menu.add(this.newOODoc);GO.mailings.ooTemplatesStore.on("load",function(){this.newOODoc.setDisabled(GO.mailings.ooTemplatesStore.getCount()==0)},this)}if(GO.tasks){this.scheduleCallItem=new GO.tasks.ScheduleCallMenuItem();this.newMenuButton.menu.add(this.scheduleCallItem)}},setData:function(B){GO.addressbook.CompanyReadPanel.superclass.setData.call(this,B);if(GO.mailings&&!GO.mailings.ooTemplatesStore.loaded){GO.mailings.ooTemplatesStore.load()}if(B.write_permission){if(this.scheduleCallItem){var A=this.data.name;if(this.data.phone!=""){A+=" ("+this.data.phone+")"}this.scheduleCallItem.setLinkConfig({name:A,links:[{link_id:this.data.id,link_type:3}],callback:this.reload,scope:this})}}}});GO.addressbook.ContactDialog=function(C){Ext.apply(this,C);this.personalPanel=new GO.addressbook.ContactProfilePanel();this.commentPanel=new Ext.Panel({title:GO.addressbook.lang.cmdPanelComments,layout:"fit",border:false,items:[new Ext.form.TextArea({name:"comment",id:"comment",fieldLabel:"",hideLabel:true,anchor:"100% 100%"})]});this.personalPanel.on("show",function(){var E=Ext.get("first_name");if(E){E.focus()}},this);this.commentPanel.on("show",function(){Ext.get("comment").focus()},this);var A=[this.personalPanel,this.commentPanel];if(GO.mailings){A.push(new GO.mailings.SelectMailingsPanel())}if(GO.customfields&&GO.customfields.types["2"]){for(var D=0;D<GO.customfields.types["2"].panels.length;D++){A.push(GO.customfields.types["2"].panels[D])}}this.formPanel=new Ext.FormPanel({waitMsgTarget:true,url:GO.settings.modules.addressbook.url+"json.php",baseParams:{},border:false,items:[this.tabPanel=new Ext.TabPanel({border:false,activeTab:0,hideLabel:true,deferredRender:false,anchor:"100% 100%",items:A})]});this.downloadDocumentButton=new Ext.Button();this.collapsible=true;this.layout="fit";this.modal=false;this.shadow=false;this.border=false;this.height=545;this.width=820;this.plain=true;this.closeAction="hide";this.title=GO.addressbook.lang.cmdContactDialog;this.items=this.formPanel;this.buttons=[{text:GO.lang.cmdOk,handler:function(){this.saveContact(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.saveContact()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];var B=function(){this.formPanel.form.findField("first_name").focus(true)};this.focus=B.createDelegate(this);GO.addressbook.ContactDialog.superclass.constructor.call(this);this.addEvents({save:true})};Ext.extend(GO.addressbook.ContactDialog,Ext.Window,{show:function(B){if(!this.rendered){this.render(Ext.getBody())}if(GO.mailings&&!GO.mailings.writableMailingsStore.loaded){GO.mailings.writableMailingsStore.load({callback:function(){var C=GO.util.empty(B)?this.formPanel.form.getValues():{};this.show(B);this.formPanel.form.setValues(C)},scope:this})}else{var A=this.personalPanel.formAddressBooks.getValue();this.formPanel.form.reset();this.personalPanel.formAddressBooks.setValue(A);if(B){this.contact_id=B}else{this.contact_id=0}if(!GO.addressbook.writableAddressbooksStore.loaded){GO.addressbook.writableAddressbooksStore.load({callback:function(){GO.addressbook.writableAddressbooksStore.loaded=true;if(this.personalPanel.formAddressBooks.getValue()<1){this.personalPanel.formAddressBooks.selectFirst();this.personalPanel.setAddressbookID(this.personalPanel.formAddressBooks.getValue())}},scope:this})}else{if(this.personalPanel.formAddressBooks.getValue()<1){this.personalPanel.formAddressBooks.selectFirst()}}if(this.contact_id>0){this.loadContact(B)}else{GO.addressbook.ContactDialog.superclass.show.call(this)}this.tabPanel.setActiveTab(0)}},loadContact:function(A){this.formPanel.form.load({url:GO.settings.modules.addressbook.url+"json.php",params:{contact_id:A,task:"load_contact"},success:function(B,C){if(!C.result.data.write_permission){Ext.Msg.alert(GO.lang.strError,GO.lang.strNoWritePermissions)}else{this.personalPanel.setAddressbookID(C.result.data.addressbook_id);this.formPanel.form.findField("company_id").setRemoteText(C.result.data.company_name);GO.addressbook.ContactDialog.superclass.show.call(this)}},scope:this})},saveContact:function(B){var A=this.personalPanel.formCompany.getRawValue();this.formPanel.form.submit({url:GO.settings.modules.addressbook.url+"action.php",waitMsg:GO.lang.waitMsgSave,params:{task:"save_contact",contact_id:this.contact_id,company:A},success:function(C,D){if(D.result.contact_id){this.contact_id=D.result.contact_id}this.fireEvent("save",this,this.contact_id);if(B){this.hide()}},failure:function(C,D){if(D.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,D.result.feedback)}},scope:this})}});GO.addressbook.CompanyDialog=function(C){Ext.apply(this,C);this.personalPanel=new GO.addressbook.CompanyProfilePanel();this.commentPanel=new Ext.Panel({title:GO.addressbook.lang.cmdPanelComments,layout:"fit",border:false,items:[new Ext.form.TextArea({name:"comment",id:"comment-company",fieldLabel:"",hideLabel:true})]});this.employeePanel=new GO.addressbook.EmployeesPanel();var A=[this.personalPanel,this.commentPanel];if(GO.mailings){A.push(new GO.mailings.SelectMailingsPanel())}A.push(this.employeePanel);if(GO.customfields&&GO.customfields.types["3"]){for(var D=0;D<GO.customfields.types["3"].panels.length;D++){A.push(GO.customfields.types["3"].panels[D])}}this.companyForm=new Ext.FormPanel({waitMsgTarget:true,border:false,baseParams:{},items:[this.tabPanel=new Ext.TabPanel({border:false,activeTab:0,deferredRender:false,hideLabel:true,anchor:"100% 100%",items:A})]});this.id="addressbook-window-new-company";this.layout="fit";this.modal=false;this.shadow=false;this.border=false;this.height=500;this.width=820;this.plain=true;this.closeAction="hide";this.collapsible=true;this.title=GO.addressbook.lang.cmdCompanyDialog;this.items=this.companyForm;this.buttons=[{id:"ok",text:GO.lang.cmdOk,handler:function(){this.saveCompany(true)},scope:this},{id:"apply",text:GO.lang.cmdApply,handler:function(){this.saveCompany()},scope:this},{id:"close",text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];var B=function(){this.companyForm.form.findField("name").focus(true)};this.focus=B.createDelegate(this);GO.addressbook.CompanyDialog.superclass.constructor.call(this);this.addEvents({save:true})};Ext.extend(GO.addressbook.CompanyDialog,Ext.Window,{show:function(A){if(GO.mailings&&!GO.mailings.writableMailingsStore.loaded){GO.mailings.writableMailingsStore.load({callback:function(){this.show(A)},scope:this})}else{if(!this.rendered){this.render(Ext.getBody())}if(A){this.company_id=A}else{this.company_id=0}if(!GO.addressbook.writableAddressbooksStore.loaded){GO.addressbook.writableAddressbooksStore.load({callback:function(){GO.addressbook.writableAddressbooksStore.loaded=true;if(this.personalPanel.formAddressBooks.getValue()<1){this.personalPanel.formAddressBooks.selectFirst()}},scope:this})}else{if(this.personalPanel.formAddressBooks.getValue()<1){this.personalPanel.formAddressBooks.selectFirst()}}this.tabPanel.setActiveTab(0);if(this.company_id>0){this.loadCompany(A)}else{this.employeePanel.setCompanyId(0);var B=this.personalPanel.formAddressBooks.getValue();this.companyForm.form.reset();this.personalPanel.formAddressBooks.setValue(B);this.personalPanel.setCompanyId(0);GO.addressbook.CompanyDialog.superclass.show.call(this)}}},loadCompany:function(A){this.companyForm.form.load({url:GO.settings.modules.addressbook.url+"json.php",params:{company_id:A,task:"load_company"},success:function(B,C){if(!C.result.data.write_permission){Ext.Msg.alert(GO.lang.strError,GO.lang.strNoWritePermissions)}else{this.employeePanel.setCompanyId(C.result.data.id);this.personalPanel.setCompanyId(C.result.data.id);GO.addressbook.CompanyDialog.superclass.show.call(this)}},failure:function(B,C){if(C.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,C.result.feedback)}},scope:this})},saveCompany:function(A){this.companyForm.form.submit({url:GO.settings.modules.addressbook.url+"action.php",params:{task:"save_company",company_id:this.company_id},waitMsg:GO.lang.waitMsgSave,success:function(B,C){if(C.result.company_id){this.company_id=C.result.company_id;this.employeePanel.setCompanyId(C.result.company_id)}this.fireEvent("save",this,this.company_id);if(A){this.hide()}},failure:function(B,C){if(C.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,C.result.feedback)}},scope:this})}});GO.addressbook.SelectContactDialog=function(A){Ext.apply(this,A);this.searchField=new GO.form.SearchField({width:320});this.grid=new GO.addressbook.ContactsGrid({tbar:[GO.lang.strSearch+": "," ",this.searchField]});delete this.grid.store.baseParams.enable_mailings_filter;this.searchField.store=this.grid.store;var B=function(){this.searchField.focus(true)};GO.addressbook.SelectContactDialog.superclass.constructor.call(this,{layout:"fit",modal:false,focus:B.createDelegate(this),height:400,width:600,closeAction:"hide",title:GO.addressbook.lang.strSelectContact,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.addressbook.SelectContactDialog,Ext.Window,{show:function(){GO.addressbook.SelectContactDialog.superclass.show.call(this);this.grid.store.load()},callHandler:function(A){if(this.handler){if(!this.scope){this.scope=this}var B=this.handler.createDelegate(this.scope,[this.grid]);B.call()}if(A){this.hide()}}});GO.addressbook.SelectCompanyDialog=function(A){Ext.apply(this,A);this.searchField=new GO.form.SearchField({width:320});this.grid=new GO.addressbook.CompaniesGrid({tbar:[GO.lang.strSearch+": "," ",this.searchField]});delete this.grid.store.baseParams.enable_mailings_filter;this.searchField.store=this.grid.store;var B=function(){this.searchField.focus(true)};GO.addressbook.SelectCompanyDialog.superclass.constructor.call(this,{layout:"fit",focus:B.createDelegate(this),modal:false,height:400,width:600,closeAction:"hide",title:GO.addressbook.lang.strSelectCompany,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.addressbook.SelectCompanyDialog,Ext.Window,{show:function(){if(!this.grid.store.loaded){this.grid.store.load()}GO.addressbook.SelectCompanyDialog.superclass.show.call(this)},callHandler:function(A){if(this.handler){if(!this.scope){this.scope=this}var B=this.handler.createDelegate(this.scope,[this.grid]);B.call()}if(A){this.hide()}}});GO.addressbook.ContactsGrid=function(B){if(!B){B={}}B.paging=true;B.border=false;var A={fields:["id","name","company_name","first_name","middle_name","last_name","title","initials","sex","birthday","email","email2","email3","home_phone","work_phone","work_fax","cellular","fax","address","address_no","zip","city","state","country","function","department","salutation","ctime","mtime"],columns:[{header:GO.lang.strName,dataIndex:"name"},{header:GO.lang.strCompany,dataIndex:"company_name"},{header:GO.lang.strFirstName,dataIndex:"first_name",hidden:true},{header:GO.lang.strMiddleName,dataIndex:"middle_name",hidden:true},{header:GO.lang.strLastName,dataIndex:"last_name",hidden:true},{header:GO.lang.strTitle,dataIndex:"title",hidden:true},{header:GO.lang.strInitials,dataIndex:"initials",hidden:true},{header:GO.lang.strSex,dataIndex:"sex",hidden:true},{header:GO.lang.strBirthday,dataIndex:"birthday",hidden:true},{header:GO.lang.strEmail,dataIndex:"email",width:150,hidden:true},{header:GO.lang.strEmail+" 2",dataIndex:"email2",width:150,hidden:true},{header:GO.lang.strEmail+" 3",dataIndex:"email3",width:150,hidden:true},{header:GO.lang.strPhone,dataIndex:"home_phone",width:100,hidden:true},{header:GO.lang.strWorkPhone,dataIndex:"work_phone",width:100,hidden:true},{header:GO.lang.strWorkFax,dataIndex:"work_fax",width:100,hidden:true},{header:GO.lang.strCellular,dataIndex:"cellular",width:100,hidden:true},{header:GO.lang.strFax,dataIndex:"fax",width:100,hidden:true},{header:GO.lang.strAddress,dataIndex:"address",hidden:true},{header:GO.lang.strAddressNo,dataIndex:"address_no",hidden:true},{header:GO.lang.strZip,dataIndex:"zip",hidden:true},{header:GO.lang.strCity,dataIndex:"city",hidden:true},{header:GO.lang.strState,dataIndex:"state",hidden:true},{header:GO.lang.strCountry,dataIndex:"country",hidden:true},{header:GO.lang.strFunction,dataIndex:"function",hidden:true},{header:GO.lang.strDepartment,dataIndex:"department",hidden:true},{header:GO.lang.strSalutation,dataIndex:"salutation",hidden:true},{header:GO.lang.strMtime,dataIndex:"mtime",hidden:true,width:80},{header:GO.lang.strCtime,dataIndex:"ctime",hidden:true,width:80}]};if(GO.customfields){GO.customfields.addColumns(2,A)}B.store=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"contacts",enable_mailings_filter:true},root:"results",id:"id",totalProperty:"total",fields:A.fields,remoteSort:true});var C=new Ext.grid.ColumnModel(A.columns);C.defaultSortable=true;B.cm=C;B.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems}),B.sm=new Ext.grid.RowSelectionModel();B.loadMask=true;B.enableDragDrop=true;B.ddGroup="AddressBooksDD";GO.addressbook.ContactsGrid.superclass.constructor.call(this,B);this.on("rowdblclick",function(E,F){var D=E.getStore().getAt(F);GO.addressbook.contactDialog.show(D.data.id)},this)};Ext.extend(GO.addressbook.ContactsGrid,GO.grid.GridPanel,{loaded:false,afterRender:function(){GO.addressbook.ContactsGrid.superclass.afterRender.call(this);if(this.isVisible()){this.onGridShow()}},onGridShow:function(){if(!this.loaded&&this.rendered){this.store.load();this.loaded=true}}});GO.addressbook.CompaniesGrid=function(B){if(!B){B={}}B.border=false;B.paging=true;var A={fields:["id","name","homepage","email","phone","fax","address","address_no","zip","city","state","country","post_address","post_address_no","post_city","post_state","post_country","post_zip","bank_no","vat_no","ctime","mtime"],columns:[{header:GO.lang.strName,dataIndex:"name"},{header:GO.lang.strEmail,dataIndex:"email",width:150,hidden:true},{header:GO.lang.strHomepage,dataIndex:"homepage",width:100,hidden:true},{header:GO.lang.strPhone,dataIndex:"phone",width:100},{header:GO.lang.strFax,dataIndex:"fax",width:80,hidden:true},{header:GO.lang.strAddress,dataIndex:"address",hidden:true},{header:GO.lang.strAddressNo,dataIndex:"address_no",hidden:true},{header:GO.lang.strZip,dataIndex:"zip",hidden:true},{header:GO.lang.strCity,dataIndex:"city",hidden:true},{header:GO.lang.strState,dataIndex:"state",width:80,hidden:true},{header:GO.lang.strCountry,dataIndex:"country",hidden:true},{header:GO.lang.strPostAddress,dataIndex:"post_address",hidden:true},{header:GO.lang.strPostAddressNo,dataIndex:"post_address_no",hidden:true},{header:GO.lang.strPostZip,dataIndex:"post_zip",hidden:true},{header:GO.lang.strPostCity,dataIndex:"post_city",hidden:true},{header:GO.lang.strPostState,dataIndex:"post_state",width:80,hidden:true},{header:GO.lang.strPostCountry,dataIndex:"post_country",hidden:true},{header:GO.addressbook.lang.cmdFormLabelBankNo,dataIndex:"bank_no",hidden:true},{header:GO.addressbook.lang.cmdFormLabelVatNo,dataIndex:"vat_no",hidden:true},{header:GO.lang.strMtime,dataIndex:"mtime",hidden:true,width:80},{header:GO.lang.strCtime,dataIndex:"ctime",hidden:true,width:80}]};if(GO.customfields){GO.customfields.addColumns(3,A)}B.store=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"companies",enable_mailings_filter:true},root:"results",id:"id",totalProperty:"total",fields:A.fields,remoteSort:true});var C=new Ext.grid.ColumnModel(A.columns);C.defaultSortable=true;B.cm=C;B.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems}),B.sm=new Ext.grid.RowSelectionModel();B.loadMask=true;B.enableDragDrop=true;B.ddGroup="AddressBooksDD";GO.addressbook.CompaniesGrid.superclass.constructor.call(this,B);this.on("rowdblclick",function(E,F){var D=E.getStore().getAt(F);GO.addressbook.companyDialog.show(D.data.id)},this)};Ext.extend(GO.addressbook.CompaniesGrid,GO.grid.GridPanel,{loaded:false,afterRender:function(){GO.addressbook.CompaniesGrid.superclass.afterRender.call(this);if(this.isVisible()){this.onGridShow()}},onGridShow:function(){if(!this.loaded&&this.rendered){this.store.load();this.loaded=true}}});GO.addressbook.SearchPanel=function(B){if(!B){B={}}B.layout="table";B.split=true;B.height=40;B.keys=[{key:Ext.EventObject.ENTER,fn:function(){this.selectedLetter="";this.alphabetView.clearSelections();this.fireQueryEvent()},scope:this}];this.alphabetArray=GO.addressbook.lang.alphabet.split(",");var D=new Array();D.push({value:"[0-9]"});for(var C=0;C<this.alphabetArray.length;C++){D.push({value:this.alphabetArray[C]})}var A=new Ext.XTemplate('<tpl for=".">','<span class="letter" onclick="">{value}</span>',"</tpl>");this.selectedLetter=0;this.alphabetView=new Ext.DataView({height:30,store:new Ext.data.JsonStore({fields:["value"],data:D}),tpl:A,autoHeight:true,singleSelect:true,cls:"alphabet-view",overClass:"alphabet-view-over",selectedClass:"alphabet-view-selected",itemSelector:"span.letter"});this.alphabetView.on("selectionchange",function(F,E){if(E[0]){this.selectedLetter=E[0].innerHTML;this.queryField.setValue("");this.fireQueryEvent()}},this);this.alphabetView.on("containerclick",function(E,F){return false},this);this.queryField=new Ext.form.TextField({name:"query",width:150});B.defaults={border:false,cls:"ab-search-form-panel"};B.items=[{items:this.alphabetView},{html:GO.lang.strSearch+":"},{items:this.queryField},{items:new Ext.Button({handler:function(){this.selectedLetter="";this.alphabetView.clearSelections();this.fireQueryEvent()},text:GO.lang.strSearch,scope:this})},{items:new Ext.Button({handler:function(){if(!this.advancedSearchWindow){this.advancedSearchWindow=new GO.addressbook.AdvancedSearchWindow();this.advancedSearchWindow.on("ok",function(F){this.fireEvent("queryChange",{advancedQuery:Ext.encode(F.getGridData())})},this)}var E=this.ab.tabPanel.getActiveTab().id=="ab-contacts-grid"?"contacts":"companies";this.advancedSearchWindow.show(E)},text:GO.addressbook.lang.advancedSearch,scope:this})},{items:new Ext.Button({handler:function(){this.selectedLetter="";this.alphabetView.clearSelections();this.queryField.setValue("");this.fireQueryEvent()},text:GO.lang.cmdReset,scope:this})},{html:GO.addressbook.lang.cmdFormSearchFourth}];GO.addressbook.SearchPanel.superclass.constructor.call(this,B);this.addEvents({queryChange:true})};Ext.extend(GO.addressbook.SearchPanel,Ext.Panel,{selectedLetter:"",fireQueryEvent:function(){var A={clicked_letter:this.selectedLetter,query:this.queryField.getValue(),advancedQuery:""};this.fireEvent("queryChange",A)}});GO.addressbook.ContactProfilePanel=function(A){Ext.apply(A);this.formFirstName=new Ext.form.TextField({fieldLabel:GO.lang.strFirstName,name:"first_name",panel:this,validateValue:function(C){var B=(C!=""||this.panel.formLastName.getValue()!="");if(!B){this.markInvalid(this.blankText)}else{this.panel.formLastName.clearInvalid()}return B}});this.formMiddleName=new Ext.form.TextField({fieldLabel:GO.lang.strMiddleName,name:"middle_name"});this.formLastName=new Ext.form.TextField({fieldLabel:GO.lang.strLastName,name:"last_name",panel:this,validateValue:function(C){var B=(C!=""||this.panel.formFirstName.getValue()!="");if(!B){this.markInvalid(this.blankText)}else{this.panel.formFirstName.clearInvalid()}return B}});this.formTitle=new Ext.form.TextField({fieldLabel:GO.lang.strTitle,name:"title"});this.formInitials=new Ext.form.TextField({fieldLabel:GO.lang.strInitials,name:"initials"});this.sexCombo=new GO.form.ComboBox({fieldLabel:GO.lang.strSex,hiddenName:"sex",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["M",GO.lang.strMale],["F",GO.lang.strFemale]]}),value:"M",valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true});this.formSalutation=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelSalutation,name:"salutation"});this.formBirthday=new Ext.form.DateField({fieldLabel:GO.lang.strBirthday,name:"birthday",format:GO.settings.date_format});this.formEmail=new Ext.form.TextField({fieldLabel:GO.lang.strEmail,name:"email"});this.formEmail2=new Ext.form.TextField({fieldLabel:GO.lang.strEmail+" 2",name:"email2"});this.formEmail3=new Ext.form.TextField({fieldLabel:GO.lang.strEmail+" 3",name:"email3"});this.formHomePhone=new Ext.form.TextField({fieldLabel:GO.lang.strPhone,name:"home_phone"});this.formFax=new Ext.form.TextField({fieldLabel:GO.lang.strFax,name:"fax"});this.formCellular=new Ext.form.TextField({fieldLabel:GO.lang.strCellular,name:"cellular"});this.formAddress=new Ext.form.TextField({fieldLabel:GO.lang.strAddress,name:"address"});this.formAddressNo=new Ext.form.TextField({fieldLabel:GO.lang.strAddressNo,name:"address_no"});this.formPostal=new Ext.form.TextField({fieldLabel:GO.lang.strZip,name:"zip"});this.formCity=new Ext.form.TextField({fieldLabel:GO.lang.strCity,name:"city"});this.formState=new Ext.form.TextField({fieldLabel:GO.lang.strState,name:"state"});this.formCountry=new GO.form.SelectCountry({fieldLabel:GO.lang.strCountry,name:"country_text",hiddenName:"country"});this.formCompany=new GO.addressbook.SelectCompany({fieldLabel:GO.lang.strCompany,name:"company",hiddenName:"company_id",emptyText:GO.addressbook.lang.cmdFormCompanyEmptyText,addressbook_id:this.addressbook_id});this.formDepartment=new Ext.form.TextField({fieldLabel:GO.lang.strDepartment,name:"department"});this.formFunction=new Ext.form.TextField({fieldLabel:GO.lang.strFunction,name:"function"});this.formWorkPhone=new Ext.form.TextField({fieldLabel:GO.lang.strWorkPhone,name:"work_phone"});this.formWorkFax=new Ext.form.TextField({fieldLabel:GO.lang.strWorkFax,name:"work_fax"});this.formAddressBooks=new GO.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdFormLabelAddressBooks,store:GO.addressbook.writableAddressbooksStore,displayField:"name",valueField:"id",hiddenName:"addressbook_id",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,allowBlank:false,anchor:"100%"});this.formAddressBooks.on("beforeselect",function(C,B){if(this.formCompany.getValue()==0||confirm(GO.addressbook.lang.moveAll)){this.setAddressbookID(B.data.id);return true}else{return false}},this);this.formMiddleName.on("blur",this.setSalutation,this);this.formLastName.on("blur",this.setSalutation,this);this.sexCombo.on("change",this.setSalutation,this);this.addressbookFieldset={xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetSelectAddressbook,autoHeight:true,collapsed:false,items:this.formAddressBooks};this.personalFieldset={xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetPersonalDetails,autoHeight:true,collapsed:false,defaults:{border:false,anchor:"100%"},items:[this.formFirstName,this.formMiddleName,this.formLastName,this.formTitle,this.formInitials,this.sexCombo,this.formSalutation,this.formBirthday]};this.addressFieldset={xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetAddress,autoHeight:true,collapsed:false,defaults:{border:false,anchor:"100%"},items:[this.formAddress,this.formAddressNo,this.formPostal,this.formCity,this.formState,this.formCountry]};this.contactFieldset={xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetContact,autoHeight:true,collapsed:false,defaults:{border:false,anchor:"100%"},items:[this.formEmail,this.formEmail2,this.formEmail3,this.formHomePhone,this.formFax,this.formCellular,this.formWorkPhone,this.formWorkFax]};this.workFieldset={xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetWork,autoHeight:true,collapsed:false,defaults:{border:false,anchor:"100%"},items:[this.formCompany,this.formDepartment,this.formFunction]};this.title=GO.addressbook.lang.cmdPanelContact;this.bodyStyle="padding:5px";this.layout="column";this.labelWidth=125;this.defaults={border:false};this.items=[{columnWidth:0.5,autoScroll:true,items:[this.addressbookFieldset,this.personalFieldset,this.workFieldset]},{columnWidth:0.5,style:"margin-left: 5px;",items:[this.contactFieldset,this.addressFieldset]}];GO.addressbook.ContactProfilePanel.superclass.constructor.call(this)};Ext.extend(GO.addressbook.ContactProfilePanel,Ext.Panel,{setSalutation:function(){var B=this.formMiddleName.getValue();var A=this.formLastName.getValue();var C=" ";var D=GO.addressbook.lang.cmdSalutation;if(this.sexCombo.getValue()=="M"){D+=C+GO.addressbook.lang.cmdSir}else{D+=C+GO.addressbook.lang.cmdMadam}if(B!=""){D+=C+B}if(A!=""){D+=C+A}this.formSalutation.setRawValue(D)},setAddressbookID:function(A){this.formAddressBooks.setValue(A);this.formCompany.store.baseParams.addressbook_id=A;this.formCompany.clearLastSearch()}});GO.addressbook.CompanyProfilePanel=function(A){Ext.apply(A);this.formAddress=new Ext.form.TextField({fieldLabel:GO.lang.strAddress,name:"address",listeners:{change:function(C,B){if(this.formPostAddress.getValue()==""){this.formPostAddress.setValue(B)}},scope:this}});this.formAddressNo=new Ext.form.TextField({fieldLabel:GO.lang.strAddressNo,name:"address_no",listeners:{change:function(C,B){if(this.formPostAddressNo.getValue()==""){this.formPostAddressNo.setValue(B)}},scope:this}});this.formZip=new Ext.form.TextField({fieldLabel:GO.lang.strZip,name:"zip",listeners:{change:function(C,B){if(this.formPostZip.getValue()==""){this.formPostZip.setValue(B)}},scope:this}});this.formCity=new Ext.form.TextField({fieldLabel:GO.lang.strCity,name:"city",listeners:{change:function(C,B){if(this.formPostCity.getValue()==""){this.formPostCity.setValue(B)}},scope:this}});this.formState=new Ext.form.TextField({fieldLabel:GO.lang.strState,name:"state",listeners:{change:function(C,B){if(this.formPostState.getValue()==""){this.formPostState.setValue(B)}},scope:this}});this.formCountry=new GO.form.SelectCountry({fieldLabel:GO.lang.strCountry,name:"country_text",hiddenName:"country",listeners:{change:function(C,B){if(this.formPostCountry.getValue()==""){this.formPostCountry.setValue(B)}},scope:this}});this.formPostAddress=new Ext.form.TextField({fieldLabel:GO.lang.strAddress,name:"post_address"});this.formPostAddressNo=new Ext.form.TextField({fieldLabel:GO.lang.strAddressNo,name:"post_address_no"});this.formPostZip=new Ext.form.TextField({fieldLabel:GO.lang.strZip,name:"post_zip"});this.formPostCity=new Ext.form.TextField({fieldLabel:GO.lang.strCity,name:"post_city"});this.formPostState=new Ext.form.TextField({fieldLabel:GO.lang.strState,name:"post_state"});this.formPostCountry=new GO.form.SelectCountry({fieldLabel:GO.lang.strCountry,name:"post_country_text",hiddenName:"post_country"});this.formName=new Ext.form.TextField({fieldLabel:GO.lang.strName,name:"name"});this.formPhone=new Ext.form.TextField({fieldLabel:GO.lang.strPhone,name:"phone",allowBlank:true,labelSeparator:this.separator,width:this.widthLeftColumn});this.formFax=new Ext.form.TextField({fieldLabel:GO.lang.strFax,name:"fax"});this.formEmail=new Ext.form.TextField({fieldLabel:GO.lang.strEmail,name:"email"});this.formHomepage=new Ext.form.TextField({fieldLabel:GO.lang.strHomepage,name:"homepage"});this.formBankNo=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelBankNo,name:"bank_no"});this.formVatNo=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelVatNo,name:"vat_no"});this.formAddressBooks=new GO.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdFormLabelAddressBooks,store:GO.addressbook.writableAddressbooksStore,displayField:"name",valueField:"id",hiddenName:"addressbook_id",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,anchor:"100%"});this.formAddressBooks.on("beforeselect",function(C,B){if(this.company_id>0){return confirm(GO.addressbook.lang.moveAll)}},this);this.title=GO.addressbook.lang.cmdPanelCompany;this.labelWidth=120;this.bodyStyle="padding: 5px";this.layout="column";this.defaults={border:false};this.items=[{columnWidth:0.5,defaults:{border:false},items:[{xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetSelectAddressbook,autoHeight:true,border:true,collapsed:false,items:this.formAddressBooks},{xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetCompanyDetails,autoHeight:true,collapsed:false,border:true,defaults:{border:false,anchor:"100%"},items:[this.formName,this.formPhone,this.formFax,this.formEmail,this.formHomepage,this.formBankNo,this.formVatNo]}]},{columnWidth:0.5,defaults:{border:false},style:"margin-left: 5px;",items:[{xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetVisitAddress,autoHeight:true,collapsed:false,border:true,defaults:{border:false,anchor:"100%"},items:[this.formAddress,this.formAddressNo,this.formZip,this.formCity,this.formState,this.formCountry]},{xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetPostAddress,autoHeight:true,collapsed:false,border:true,defaults:{border:false,anchor:"100%"},items:[this.formPostAddress,this.formPostAddressNo,this.formPostZip,this.formPostCity,this.formPostState,this.formPostCountry]}]}];GO.addressbook.CompanyProfilePanel.superclass.constructor.call(this)};Ext.extend(GO.addressbook.CompanyProfilePanel,Ext.Panel,{setCompanyId:function(A){this.company_id=A}});GO.addressbook.EmployeesPanel=function(A){if(!A){A={}}A.store=new Ext.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{company_id:this.company_id,task:"load_employees"},id:"id",root:"results",fields:[{name:"id"},{name:"name"},{name:"function"},{name:"department"},{name:"phone"},{name:"email"}],remoteSort:true});A.store.on("load",function(){this.loaded=true},this);A.cm=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"name"},{header:GO.lang.strEmail,dataIndex:"email",width:200},{header:GO.lang.strPhone,dataIndex:"phone",width:100},{header:GO.lang.strFunction,dataIndex:"function",width:150},{header:GO.lang.strDepartment,dataIndex:"department",width:150}]);A.cm.defaultSortable=true;A.view=new Ext.grid.GridView({autoFill:true,forceFit:true});A.layout="fit";A.paging=true;A.title=GO.addressbook.lang.cmdPanelEmployees;A.id="ab-employees-grid";A.sm=new Ext.grid.RowSelectionModel({singleSelect:true});A.autoScroll=false;A.trackMouseOver=true;A.collapsible=false;A.disabled=true;A.tbar=[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){if(!this.selectContactDialog){this.selectContactDialog=new GO.addressbook.SelectContactDialog({handler:function(B){var C=B.selModel.selections.keys;this.store.baseParams.add_contacts=Ext.encode(C);this.store.load();delete this.store.baseParams.add_contacts},scope:this})}this.selectContactDialog.grid.store.baseParams.addressbook_id=this.ownerCt.ownerCt.ownerCt.companyForm.form.findField("addressbook_id").getValue();this.selectContactDialog.show()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.deleteSelected()},scope:this}];GO.addressbook.EmployeesPanel.superclass.constructor.call(this,A);this.on("rowdblclick",function(D,C){var B=D.getStore().getAt(C);GO.addressbook.contactDialog.show(B.data.id)},this)};Ext.extend(GO.addressbook.EmployeesPanel,GO.grid.GridPanel,{setCompanyId:function(A){if(A!=this.store.baseParams.company_id){this.loaded=false;this.store.baseParams.company_id=A;this.setDisabled(A==0)}},onShow:function(){if(!this.loaded){this.store.load()}GO.addressbook.CompanyProfilePanel.superclass.onShow.call(this)}});GO.addressbook.AdvancedSearchWindow=function(C){if(!C){C={}}var A=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"fields",type:""},root:"results",id:"field",fields:["field","label","value","type","options"],remoteSort:true});var B=new Ext.grid.ColumnModel({columns:[{header:GO.lang.field,dataIndex:"label"},{header:GO.lang.value,dataIndex:"value",editable:true}],editors:{text:new Ext.grid.GridEditor(new Ext.form.TextField({})),textarea:new Ext.grid.GridEditor(new Ext.form.TextArea({})),number:new Ext.grid.GridEditor(new GO.form.NumberField({})),date:new Ext.grid.GridEditor(new Ext.form.DateField({format:GO.settings.date_format})),checkbox:new Ext.grid.GridEditor(new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","text"],data:[["",GO.lang.strNA],["1",GO.lang.on],["0",GO.lang.off]]}),valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:true,selectOnFocus:true,forceSelection:true})),country:new Ext.grid.GridEditor(new GO.form.SelectCountry({}))},getCellEditor:function(D,F){var E=A.getAt(F);if(!this.editors[E.get("type")]&&E.get("options")){this.editors[E.get("type")]=new Ext.grid.GridEditor(new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["text"],data:E.get("options")}),displayField:"text",mode:"local",triggerAction:"all",editable:true,selectOnFocus:true}))}return this.editors[E.get("type")]||this.editors.text}});this.grid=new Ext.grid.EditorGridPanel({cm:B,layout:"fit",view:new Ext.grid.GridView({autoFill:true}),loadMask:{msg:GO.lang.waitMsgLoad},clicksToEdit:1,store:A});C.items=this.grid;C.collapsible=true;C.layout="fit";C.modal=false;C.resizable=true;C.width=500;C.height=400;C.closeAction="hide";C.title=GO.addressbook.lang.advancedSearch;C.buttons=[{text:GO.lang.cmdOk,handler:function(){this.fireEvent("ok",this);this.hide()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.addressbook.AdvancedSearchWindow.superclass.constructor.call(this,C);this.addEvents({ok:true})};Ext.extend(GO.addressbook.AdvancedSearchWindow,GO.Window,{editor:new Ext.form.TextField(),getCellEditor:function(A,B){console.log(this);return this.editor},show:function(A){if(A!=this.grid.store.baseParams.type){this.grid.store.baseParams.type=A;this.grid.store.load()}GO.addressbook.AdvancedSearchWindow.superclass.show.call(this)},getGridData:function(){var C={};for(var A=0;A<this.grid.store.data.items.length;A++){var B=this.grid.store.data.items[A];if(!GO.util.empty(B.get("value"))){C[B.get("field")]=B.get("value")}}return C}});GO.addressbook.MainPanel=function(A){if(!A){A={}}this.contactsGrid=new GO.addressbook.ContactsGrid({layout:"fit",region:"center",id:"ab-contacts-grid-panel"});this.contactsGrid.on("delayedrowselect",function(D,F,E){this.contactEastPanel.load(E.get("id"))},this);this.contactsGrid.store.on("load",function(){this.setAdvancedSearchNotification(this.contactsGrid.store)},this);this.companiesGrid=new GO.addressbook.CompaniesGrid({layout:"fit",region:"center",id:"ab-company-grid-panel"});this.companiesGrid.on("delayedrowselect",function(D,F,E){this.companyEastPanel.load(E.get("id"))},this);this.companiesGrid.store.on("load",function(){this.setAdvancedSearchNotification(this.companiesGrid.store)},this);this.searchPanel=new GO.addressbook.SearchPanel({region:"north",ab:this});this.searchPanel.on("queryChange",function(D){this.setSearchParams(D)},this);this.contactEastPanel=new GO.addressbook.ContactReadPanel({region:"east",title:GO.addressbook.lang.cmdPanelContact,width:420});this.companyEastPanel=new GO.addressbook.CompanyReadPanel({region:"east",title:GO.addressbook.lang.cmdPanelCompany,width:420});this.contactsPanel=new Ext.Panel({id:"ab-contacts-grid",title:GO.addressbook.lang.contacts,layout:"border",items:[this.contactsGrid,this.contactEastPanel]});this.contactsPanel.on("show",function(){this.contactsGrid.onGridShow();this.setAdvancedSearchNotification(this.contactsGrid.store);this.addressbooksGrid.setType("contact")},this);this.companyPanel=new Ext.Panel({id:"ab-company-grid",title:GO.addressbook.lang.companies,layout:"border",items:[this.companiesGrid,this.companyEastPanel]});this.companyPanel.on("show",this.companiesGrid.onGridShow,this.companiesGrid);this.companyPanel.on("show",function(){this.companiesGrid.onGridShow();this.setAdvancedSearchNotification(this.companiesGrid.store);this.addressbooksGrid.setType("company")},this);this.addressbooksGrid=new GO.addressbook.AddresbooksGrid({region:"west",id:"ab-addressbook-grid",width:180});this.addressbooksGrid.on("rowclick",function(E,F){var D=E.getStore().getAt(F);this.setSearchParams({addressbook_id:D.get("id")})},this);this.addressbooksGrid.on("drop",function(D){if(D=="company"){this.companiesGrid.store.reload()}else{this.contactsGrid.store.reload()}},this);this.tabPanel=new Ext.TabPanel({region:"center",activeTab:0,border:true,items:[this.contactsPanel,this.companyPanel]});A.layout="border";A.border=false;A.id="ab-tbar";if(GO.mailings){this.mailingsFilterPanel=new GO.mailings.MailingsFilterPanel({region:"center"});this.mailingsFilterPanel.on("change",function(F,E){var D=this.tabPanel.getActiveTab();if(D.id=="ab-contacts-grid"){this.contactsGrid.store.baseParams.mailings_filter=Ext.encode(E);this.contactsGrid.store.load();delete this.contactsGrid.store.baseParams.mailings_filter}else{this.companiesGrid.store.baseParams.mailings_filter=Ext.encode(E);this.companiesGrid.store.load();delete this.companiesGrid.store.baseParams.mailings_filter}},this);this.addressbooksGrid.region="north";this.addressbooksGrid.height=200;var C=new Ext.Panel({layout:"border",border:false,region:"west",width:180,split:true,items:[this.addressbooksGrid,this.mailingsFilterPanel]});A.items=[this.searchPanel,C,this.tabPanel]}else{A.items=[this.searchPanel,this.addressbooksGrid,this.tabPanel]}var B=[{iconCls:"btn-addressbook-add-contact",text:GO.addressbook.lang.btnAddContact,cls:"x-btn-text-icon",handler:function(){GO.addressbook.contactDialog.show(0);this.tabPanel.setActiveTab("ab-contacts-grid")},scope:this},{iconCls:"btn-addressbook-add-company",text:GO.addressbook.lang.btnAddCompany,cls:"x-btn-text-icon",handler:function(){GO.addressbook.companyDialog.show(0);this.tabPanel.setActiveTab("ab-company-grid")},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){var D=this.tabPanel.getActiveTab();switch(D.id){case"ab-contacts-grid":this.contactsGrid.deleteSelected({callback:this.contactEastPanel.gridDeleteCallback,scope:this.contactEastPanel});break;case"ab-company-grid":this.companiesGrid.deleteSelected({callback:this.companyEastPanel.gridDeleteCallback,scope:this.companyEastPanel});break}},scope:this},"-",{iconCls:"btn-addressbook-manage",text:GO.addressbook.lang.btnManage,cls:"x-btn-text-icon",handler:function(){if(!this.manageDialog){this.manageDialog=new GO.addressbook.ManageDialog()}this.manageDialog.show()},scope:this},{iconCls:"btn-export",text:GO.lang.cmdExport,cls:"x-btn-text-icon",handler:function(){var E=this.tabPanel.getActiveTab();var D={};switch(E.id){case"ab-contacts-grid":D.query="search_contacts";D.colModel=this.contactsGrid.getColumnModel();break;case"ab-company-grid":D.query="search_companies";D.colModel=this.companiesGrid.getColumnModel();break}D.title=E.title;var F=this.searchPanel.queryField.getValue();if(!GO.util.empty(F)){D.subtitle=GO.lang.searchQuery+": "+F}else{D.subtile=""}if(!this.exportDialog){this.exportDialog=new GO.ExportQueryDialog()}this.exportDialog.show(D)},scope:this}];if(GO.mailings&&GO.email){B.push("-");B.push({iconCls:"ml-btn-mailings",text:GO.addressbook.lang.sendMailing,cls:"x-btn-text-icon",handler:function(){if(!this.selectMailingGroupWindow){this.selectMailingGroupWindow=new GO.mailings.SelectMailingGroupWindow();this.selectMailingGroupWindow.on("select",function(E,D){GO.email.showComposer({mailing_group_id:D})},this)}this.selectMailingGroupWindow.show()},scope:this})}A.tbar=new Ext.Toolbar({cls:"go-head-tb",items:B});GO.addressbook.MainPanel.superclass.constructor.call(this,A)};Ext.extend(GO.addressbook.MainPanel,Ext.Panel,{setAdvancedSearchNotification:function(A){if(!GO.util.empty(A.baseParams.advancedQuery)){this.searchPanel.queryField.setValue("[ "+GO.addressbook.lang.advancedSearch+" ]");this.searchPanel.queryField.setDisabled(true)}else{if(this.searchPanel.queryField.getValue()=="[ "+GO.addressbook.lang.advancedSearch+" ]"){this.searchPanel.queryField.setValue("")}this.searchPanel.queryField.setDisabled(false)}},afterRender:function(){GO.addressbook.MainPanel.superclass.afterRender.call(this);GO.addressbook.readableAddressbooksStore.load();if(GO.mailings){if(!GO.mailings.ooTemplatesStore.loaded){GO.mailings.ooTemplatesStore.load()}}GO.addressbook.contactDialog.on("save",function(){var A=this.tabPanel.getActiveTab();if(A.id=="ab-contacts-grid"){this.contactsGrid.store.reload()}},this);GO.addressbook.companyDialog.on("save",function(){var A=this.tabPanel.getActiveTab();if(A.id=="ab-company-grid"){this.companiesGrid.store.reload()}},this)},setSearchParams:function(C){var A=this.tabPanel.getActiveTab();for(var B in C){if(B!="advancedQuery"||A.id=="ab-contacts-grid"){this.contactsGrid.store.baseParams[B]=C[B]}if(B!="advancedQuery"||A.id!="ab-contacts-grid"){this.companiesGrid.store.baseParams[B]=C[B]}}if(A.id=="ab-contacts-grid"){this.companiesGrid.loaded=false;this.contactsGrid.store.load()}else{this.contactsGrid.loaded=false;this.companiesGrid.store.load()}},rowDoubleClick:function(){var A=this.tabPanel.getActiveTab();switch(A.id){case"ab-contacts-grid":GO.addressbook.contactDialog.show(this.contactsGrid.selModel.selections.items[0].data.id);break;case"ab-company-grid":GO.addressbook.companyDialog.show(this.companiesGrid.selModel.selections.items[0].data.id);break}}});GO.mainLayout.onReady(function(){GO.addressbook.contactDialog=new GO.addressbook.ContactDialog();GO.addressbook.companyDialog=new GO.addressbook.CompanyDialog()});GO.addressbook.searchSenderStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"search_sender",email:""},root:"results",totalProperty:"total",id:"id",fields:["id","name"],remoteSort:true});GO.addressbook.searchSender=function(B,A){GO.addressbook.searchSenderStore.baseParams.email=B;GO.addressbook.searchSenderStore.load({callback:function(){switch(GO.addressbook.searchSenderStore.getCount()){case 0:if(confirm(GO.addressbook.lang.confirmCreate)){GO.addressbook.contactDialog.show();var G=A.split(" ");var H={email:B,first_name:G[0]};if(G[2]){H.last_name=G[2];H.middle_name=G[1]}else{if(G[1]){H.last_name=G[1]}}var F=B.lastIndexOf(".");if(F){var C=B.substring(F+1,B.length).toUpperCase();if(GO.lang.countries[C]){H.country=C}}GO.addressbook.contactDialog.formPanel.form.setValues(H)}break;case 1:var D=GO.addressbook.searchSenderStore.getAt(0);GO.linkHandlers[2].call(this,D.get("id"));break;default:if(!GO.addressbook.searchSenderWin){var E=new GO.grid.SimpleSelectList({store:GO.addressbook.searchSenderStore});E.on("click",function(I,J){var K=I.store.data.items[J].id;E.clearSelections();GO.addressbook.searchSenderWin.hide();GO.linkHandlers[2].call(this,K)},this);GO.addressbook.searchSenderWin=new GO.Window({title:GO.addressbook.lang.strSelectContact,items:{autoScroll:true,items:E,cls:"go-form-panel"},layout:"fit",autoScroll:true,closeAction:"hide",closeable:true,height:400,width:400,buttons:[{text:GO.lang.cmdClose,handler:function(){GO.addressbook.searchSenderWin.hide()}}]})}GO.addressbook.searchSenderWin.show();break}},scope:this})};GO.moduleManager.addModule("addressbook",GO.addressbook.MainPanel,{title:GO.addressbook.lang.addressbook,iconCls:"go-tab-icon-addressbook"});GO.linkHandlers[2]=GO.mailFunctions.showContact=function(C){var A=new GO.addressbook.ContactReadPanel();var B=new GO.LinkViewWindow({title:GO.addressbook.lang.contact,items:A});A.load(C);B.show()};GO.linkHandlers[3]=function(C){var A=new GO.addressbook.CompanyReadPanel();var B=new GO.LinkViewWindow({title:GO.addressbook.lang.company,items:A});A.load(C);B.show()};GO.addressbook.SelectAddressbook=function(A){A=A||{};if(!A.hiddenName){A.hiddenName="addressbook_id"}if(!A.fieldLabel){A.fieldLabel=GO.addressbook.lang.addressbook}Ext.apply(this,A);this.store=GO.addressbook.writableAddressbooksStore;GO.addressbook.SelectAddressbook.superclass.constructor.call(this,{displayField:"name",valueField:"id",triggerAction:"all",mode:"remote",editable:true,selectOnFocus:true,forceSelection:true,typeAhead:true,emptyText:GO.lang.strPleaseSelect,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.addressbook.SelectAddressbook,GO.form.ComboBox,{});